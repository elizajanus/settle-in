YUI.add("flickr-photosets-editMeta-updater",function(e,t){"use strict";var o=require("hermes-core/flog")(t);e.namespace("ModelUpdaters")["flickr-photosets-editMeta"]={run:function(o,s){var i={},r=this;return i.photoset_id=o.photosetId,i.title=o.title,i.description=o.description,o.includeHiddenSets&&(i.extras="hidden_sets"),e.Promise.all([s.callAPI("flickr.photosets.editMeta",i),s.getModelRegistry("set-models")]).then(function(e){r._processResponse(e,o,s)},e.FetcherErrorLogger(t))},_processResponse:function(e,t,s){var i=e[0],r=e[1];if(i.photoset&&i.photoset.title&&i.photoset.description){if(!r.exists(t.photosetId))throw new Error("[flickr-photosets-editMeta-updater] - Set model cannot be updated if it does not exist");r.setValues(t.photosetId,{title:i.photoset.title.content,description:i.photoset.description.content})}else o.warn("No updated data returned from API.")}}},"@VERSION@",{requires:["flickr-promise"]});YUI.add("flickr-photosets-setPrimaryPhoto-updater",function(r,t){"use strict";r.namespace("ModelUpdaters")["flickr-photosets-setPrimaryPhoto"]={run:function(o,e){var s={};return s.photoset_id=o.albumId,s.photo_id=o.photoId,e.callAPI("flickr.photosets.setPrimaryPhoto",s).then(null,r.FetcherErrorLogger(t))}}},"@VERSION@",{requires:["flickr-promise"]});YUI.add("set-models",function(e,t){function o(e){o.superclass.constructor.call(this,e)}var r=require("hermes-core/flog")(t);e.Models[this.name]=o,e.extend(o,e.FlickrModelRegistry,{langBundles:this.details.langBundles,name:this.name,remote:{read:function(t){return e.ListFetchers["flickr-photosets-getPhotos"].run(t,this.appContext)},create:function(t,o){return e.ModelCreators["flickr-photosets-create"].run(t,o)},createHidden:function(t,o){return e.ModelCreators["flickr-photosets-createHidden"].run(t,o)},addPhoto:function(t,o){return e.ModelCreators["flickr-photosets-addPhoto"].run(t,o)},removePhoto:function(t,o){return e.ModelCreators["flickr-photosets-removePhoto"].run(t,o)},update:function(t,o){return e.ModelUpdaters["flickr-photosets-editMeta"].run({photosetId:t,title:o.title?o.title.newVal:this.getValue(t,"title"),description:o.description?o.description.newVal:this.getValue(t,"description")},this.appContext)},setPrimaryPhoto:function(t,o){return e.ModelUpdaters["flickr-photosets-setPrimaryPhoto"].run(t,o)},delete:function(t){if("string"==typeof t){t={setID:t}}return e.ModelDeletors["flickr-photosets-delete-deletor"].run(t,this.appContext)}},addPhoto:function(e,t){return this.getValue(e,"photoPageList").hasMaxBoundary()&&this.getValue(e,"photoPageList").appendToList(t),this.getValue(e,"photoContextList").hasMaxBoundary()&&this.getValue(e,"photoContextList").appendToList(t),this},removePhoto:function(e,t){return this.getValue(e,"photoPageList").removeFromList(t.getValue("id")),this.getValue(e,"photoContextList").removeFromList(t.getValue("id")),this},hasPhoto:function(e,t){return this.getValue(e,"photoPageList").getFromListByID(t)||this.getValue(e,"photoContextList").getFromListByID(t)},getSizeToFit:function(t,o,i){r.warn("Using `getSizeToFit` is deprecated. See model comments for more details.");var n=e.PhotoModelHelper.getSizeToFit(t,o,e.merge({sizes:this.getValue(t,"primaryPhotoSizes"),includeSquare:!0,cropToFit:!0},i));return n&&(n.url=n.src),n},getLargestPrimaryPhotoSize:function(t,o){return e.PhotoModelHelper.getLargestSize(t,o)},attributes:{normalizedId:{readOnly:!0,defaultFn:function(e){return e.split("-")[0]}},displayType:{readOnly:!0,defaultFn:function(){return"set"}},title:{validator:function(t,o){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)},defaultValue:""},description:{validator:function(t,o){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)},defaultValue:""},owner:{isModel:!0},isOwner:e.PhotoModelHelper.attributes.isOwner,photoPageList:{isCollection:!0,pageFetch:{listFetcher:e.ListFetchers["flickr-photosets-getPhotos"]}},photoContextList:{isListProxy:!0,contextFetch:{listFetcher:e.ListFetchers["flickr-photosets-getContext"],listItemIdField:"photoId"}},photoCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},videoCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},publicPhotosCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},totalCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultFn:function(e){return this.getValue(e,"photoCount")+this.getValue(e,"videoCount")}},viewCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},photoCountDisplay:{readOnly:!0,derivedBy:["totalCount"],defaultFn:function(e){var t=this.getValue(e,"photoCount"),o=this.getValue(e,"videoCount"),r=this.getValue(e,"totalCount"),i="";return 0===(t-=o)&&0===o?i=this.intlMessage({intlName:"models.ZERO_PHOTOS"}):1===t&&0===o?i=this.intlMessage({intlName:"models.ONE_PHOTO"}):t>1&&0===o?i=this.intlMessage({intlName:"models.MULTIPLE_PHOTOS",photos:t}):0===t&&1===o?i=this.intlMessage({intlName:"models.ONE_VIDEO"}):1===t&&1===o?i=this.intlMessage({intlName:"models.ONE_PHOTO_AND_ONE_VIDEO"}):t>1&&1===o?i=this.intlMessage({intlName:"models.MULTIPLE_PHOTOS_AND_ONE_VIDEO",photos:t}):0===t&&o>1?i=this.intlMessage({intlName:"models.MULTIPLE_VIDEOS",videos:o}):1===t&&o>1?i=this.intlMessage({intlName:"models.ONE_PHOTO_AND_MULTIPLE_VIDEOS",videos:o}):t>1&&o>1&&(i=this.intlMessage({intlName:"models.MULTIPLE_PHOTOS_AND_MULTIPLE_VIDEOS",photos:t,videos:o})),0===r?i=this.intlMessage({intlName:"models.ZERO_ITEMS"}):1===r?i=this.intlMessage({intlName:"models.ONE_ITEM"}):r>1&&(i=this.intlMessage({intlName:"models.MULTIPLE_ITEMS",items:r})),i}},photoAndVideosDisplay:{readOnly:!0,derivedBy:["photoCount","videoCount"],defaultFn:function(e){var t=this.getValue(e,"photoCount"),o=this.getValue(e,"videoCount"),r="";return 0===t&&0===o?r=this.intlMessage({intlName:"models.ZERO_PHOTOS"}):1===t&&0===o?r=this.intlMessage({intlName:"models.ONE_PHOTO"}):t>1&&0===o?r=this.intlMessage({intlName:"models.MULTIPLE_PHOTOS",photos:t}):0===t&&1===o?r=this.intlMessage({intlName:"models.ONE_VIDEO"}):1===t&&1===o?r=this.intlMessage({intlName:"models.ONE_PHOTO_AND_ONE_VIDEO"}):t>1&&1===o?r=this.intlMessage({intlName:"models.MULTIPLE_PHOTOS_AND_ONE_VIDEO",photos:t}):0===t&&o>1?r=this.intlMessage({intlName:"models.MULTIPLE_VIDEOS",videos:o}):1===t&&o>1?r=this.intlMessage({intlName:"models.ONE_PHOTO_AND_MULTIPLE_VIDEOS",videos:o}):t>1&&o>1&&(r=this.intlMessage({intlName:"models.MULTIPLE_PHOTOS_AND_MULTIPLE_VIDEOS",photos:t,videos:o})),r}},sharedEntityDisplay:{readOnly:!0,derivedBy:["videoCount","photoCount"],defaultFn:function(e){var t=this.getValue(e,"photoCount"),o=this.getValue(e,"videoCount"),r=this.getValue(e,"owner"),i="";return t&&!o?i=this.intlMessage({intlName:"shared-entity.USERNAME_HAS_SHARED_PHOTOS_ONLY",username:r.getValue("displayname"),photoCount:parseInt(t,10)}):!t&&o?i=this.intlMessage({intlName:"shared-entity.USERNAME_HAS_SHARED_VIDEOS_ONLY",username:r.getValue("displayname"),videoCount:parseInt(o,10)}):t&&o&&(i=this.intlMessage({intlName:"shared-entity.USERNAME_HAS_SHARED_PHOTOS_VIDEOS",username:r.getValue("displayname"),photoCount:parseInt(t,10),videoCount:parseInt(o,10)})),i}},primary:{},primaryPhotoSizes:{},primaryNeedsInterstitial:{},bestIconURL:{readOnly:!0,derivedBy:["primaryPhotoSizes"],defaultFn:function(t){var o=e.PhotoModelHelper.getSizeToFit(t,{height:75,width:75},e.merge({sizes:this.getValue(t,"primaryPhotoSizes"),includeSquare:!0,cropToFit:!0}));return o?o.src:""}},url:{readOnly:!0,derivedBy:["owner","normalizedId"],defaultFn:function(e){var t=this.getValue(e,"owner"),o=this.getValue(e,"isSharedEntity"),r=this.getValue(e,"normalizedId");return t&&!0===o?"/photos/"+t.getValue("pathAlias")+"/shares/"+r:t?"/photos/"+t.getValue("pathAlias")+"/albums/"+r:void 0}},isAutoUploadSet:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},isSharedEntity:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},canShare:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0},canDownload:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},urlSuffix:{readOnly:!0,defaultFn:function(e){return this.getValue(e,"isSharedEntity")?"shares-"+e:"album-"+e}},gpCode:{defaultFn:function(e){return null}},gpOwner:{defaultFn:function(e){return null}}}},{buildCompoundId:function(e,t,o){var r=e;return t&&(r+="-"+t),o&&(t||(r+="-dateposted"),r+="-"+o),r},splitCompoundId:function(e){var t=e.split("-");return{nsid:t[0],orderBy:t[1],viewAs:t[2]}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-photosets-addPhoto-creator","flickr-photosets-removePhoto-deletor","flickr-photosets-delete-deletor","flickr-photosets-getPhotos-fetcher","flickr-photosets-getContext-fetcher","flickr-photosets-create-creator","flickr-photosets-createHidden-creator","flickr-photosets-editMeta-updater","flickr-photosets-setPrimaryPhoto-updater","photo-model-helper"],langBundles:["models","shared-entity"]});YUI.add("photo-groups-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-photos-getAllContexts"].run(t,this.appContext)}},attributes:{id:{},groups:{isCollection:!0},total:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0}}})},"@VERSION@",{requires:["api-helper","flickr-model-registry","flickr-promise","flickr-photos-getAllContexts-fetcher"]});YUI.add("flickr-photos-getAllContexts-fetcher",function(e,t){"use strict";e.namespace("ModelFetchers")["flickr-photos-getAllContexts"]={run:function(o,s){var l=this;return s.flipper.isFlipped("enable-scrappy-photo-page")&&(o.scrappy=!0),e.Promise.all([s.callAPI("flickr.photos.getAllContexts",this._processParams(o),!0),s.getModelRegistry("person-models"),s.getModelRegistry("photo-contexts-models"),s.getModelRegistry("favorite-models"),s.getModelRegistry("gallery-models"),s.getModelRegistry("group-pool-models"),s.getModelRegistry("set-models"),s.getModelRegistry("photostream-models"),s.getModelRegistry("photo-groups-models"),s.getModelRegistry("photo-sets-models"),s.getModelRegistry("photo-galleries-models"),s.getModelRegistry("group-models")]).then(function(e){return l._processResponse(e,o)},e.FetcherErrorLogger(t))},_processParams:function(t){var o;return o={photo_id:t.id,extras:e.APIHelper.request.getRebootPhotoExtras()+","+e.APIHelper.request.getRebootGroupExtras()+","+e.APIHelper.request.getRebootAlbumsListExtras(),primary_photo_extras:"url_sq, url_t, url_s, url_m, needs_interstitial"},t.scrappy&&(o.get_all_galleries=1,o.no_faves_context=1,o.per_type_limit=6,o.get_totals=1,o.sort="date-desc"),o},_processResponse:function(t,o){var s,l,r=t[0],a=t[1],p=t[2],d={},i=[],g=t[8],n=t[9],u=t[10],m=t[11];return d.faves=t[3],d.gallery=t[4],d.pool=t[5],d.set=t[6],d.stream=t[7],e.Object.each(d,function(t,o){r[o]&&e.Array.each(r[o],function(o){e.APIHelper.response.addContextToRegistry(o,t,a,m),i.push(t.proxy(o.id))})}),p.exists(o.id)||(s=p.add({id:o.id,totalGroups:r.totals&&r.totals.groups,totalSets:r.totals&&r.totals.sets,totalGalleries:r.totals&&r.totals.galleries}),p.setValue(o.id,"contexts",i)),g.addOrUpdate({id:o.id,total:r.totals&&r.totals.groups,groups:p.getContextsOfType(o.id,"group-pool-models")}),(l=p.getContextsOfType(o.id,"set-models")).forEach(function(e){e.setValue("totalCount",parseInt(e.getValue("photoCount"),10)+parseInt(e.getValue("videoCount"),10))}),n.addOrUpdate({id:o.id,total:r.totals&&r.totals.sets,sets:l}),u.addOrUpdate({id:o.id,total:r.totals&&r.totals.galleries,galleries:p.getContextsOfType(o.id,"gallery-models")}),s}}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["photo-contexts-models","favorite-models","gallery-models","group-pool-models","photostream-models","set-models","photo-groups-models","photo-sets-models","photo-galleries-models","group-models"]});YUI.add("photo-galleries-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-photos-getAllContexts"].run(t,this.appContext)}},attributes:{id:{},galleries:{isListProxy:!0},total:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0}}})},"@VERSION@",{requires:["api-helper","flickr-model-registry","flickr-promise","flickr-photos-getAllContexts-fetcher"]});YUI.add("gallery-photo-association-models",function(t){function e(t){e.superclass.constructor.call(this,t)}t.Models[this.name]=e,t.extend(e,t.FlickrModelRegistry,{langBundles:this.details.langBundles,name:this.name,attributes:{id:{validator:function(e){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)}},galleryId:{validator:function(e){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)}},photoId:{validator:function(e){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)}}}})},"@VERSION@",{requires:["flickr-model-registry"],langBundles:["models"]});YUI.add("flickr-galleries-removePhoto-deletor",function(e,o){"use strict";e.namespace("ModelCreators")["flickr-galleries-removePhoto"]={run:function(t,l){var a={},s=t.galleryCompoundID?t.galleryCompoundID.split("-").pop():t.galleryID;return a.photo_id=t.photoID,a.gallery_id=s,e.Promise.all([l.callAPI("flickr.galleries.removePhoto",a),l.getModel("gallery-models",s),l.getModel("photo-models",t.photoID),l.getModelRegistry("photo-galleries-models"),l.getModelRegistry("photo-contexts-models"),l.getModel("gallery-info-models",s),l.getModelRegistry("gallery-photo-association-models")]).then(function(e){var o=e[0],l=e[1],a=e[2],r=e[3],i=e[4],u=e[5],g=e[6];if("ok"===o.stat)return i.exists(t.photoID)&&i.getValue(t.photoID,"contexts").getFromListByID(s)&&(i.setValue(t.photoID,"totalGalleries",i.getValue(t.photoID,"totalGalleries")-1),i.getValue(t.photoID,"contexts").removeFromList(s)),r.exists(t.photoID)&&r.getValue(t.photoID,"galleries").getFromListByID(s)&&(r.setValue(t.photoID,"total",r.getValue(t.photoID,"total")-1),r.getValue(t.photoID,"galleries").removeFromList(s)),l&&(l.hasPhoto(a.getValue("id"))&&l.removePhoto(a),a.getValue("isVideo")?l.setValue("videoCount",l.getValue("videoCount")-1):l.setValue("photoCount",l.getValue("photoCount")-1),l.getValue("photoCount")+l.getValue("videoCount")===0&&(l.setValue("primary",null),l.setValue("primaryPhotoSizes",{})),u.hasPhoto(a.getValue("id"))&&(u.getValue("photoList").removeFromList(a.getValue("id")),u.getValue("photoList").totalItems--),a.getValue("isVideo")?u.setValue("videoCount",u.getValue("videoCount")-1):u.setValue("photoCount",u.getValue("photoCount")-1),u.getValue("photoCount")+u.getValue("videoCount")===0&&u.setValue("primaryPhotoId",null),g.remove(s+"-"+t.photoID)),l},e.FetcherErrorLogger(o))}}},"@VERSION@",{requires:["flickr-promise"],optional:["gallery-models","photo-models","photo-galleries-models","photo-contexts-models","gallery-info-models","gallery-photo-association-models"]});YUI.add("flickr-galleries-setPrimaryPhoto-updater",function(r,e){"use strict";r.namespace("ModelUpdaters")["flickr-galleries-setPrimaryPhoto"]={run:function(l,i){var t={};return t.gallery_id=l.galleryId,t.primary_photo_id=l.photoId,i.callAPI("flickr.galleries.setPrimaryPhoto",t).then(null,r.FetcherErrorLogger(e))}}},"@VERSION@",{requires:["flickr-promise"]});YUI.add("flickr-galleries-editPhotos-updater",function(r,e){"use strict";r.namespace("ModelUpdaters")["flickr-galleries-editPhotos"]={run:function(o,t){var i={gallery_id:o.galleryId,primary_photo_id:o.primaryPhotoId};return o.photoIds&&o.photoIds.length>0&&(i.photo_ids=o.photoIds.join(",")),t.callAPI("flickr.galleries.editPhotos",i).then(null,r.FetcherErrorLogger(e))}}},"@VERSION@",{requires:[]});YUI.add("flickr-galleries-getContext-fetcher",function(e,o){"use strict";e.namespace("ListFetchers")["flickr-galleries-getContext"]={run:function(t,s){var r=this;return e.Promise.all([s.callAPI("flickr.galleries.getContext",this._processParams(t),!0),s.getModelRegistry("gallery-models"),s.getModelRegistry("photo-models"),s.getModelRegistry("person-models"),s.getModelRegistry("photo-engagement-models"),s.getModelRegistry("photo-stats-models")]).then(function(e){return r._processResponse(e,t)},function(e){throw 3===e.code&&"Photo not in gallery"===e.message&&(e.notInContext=!0),e}).then(null,e.FetcherErrorLogger(o))},_processParams:function(o){return{gallery_id:o.compoundId||o.id,photo_id:o.photoId,extras:e.APIHelper.request.getRebootPhotoExtras(),num_prev:o.numPrev,num_next:o.numNext,user_id:o.ownerId}},_processResponse:function(o,t){var s,r,n,l,p,a,i=o[0],d=o[1],g=o[2],h=o[3],u=o[4],m=o[5],c=[],y=[],x=g.proxy(t.photoId),M=[];return s=i.nextphotos,r=i.prevphotos,y=e.APIHelper.response.parsePhotos({photos:s.photo,personModelRegistry:h,photoModelRegistry:g,photoEngagementModelRegistry:u,photoStatsModelRegistry:m}),c=e.APIHelper.response.parsePhotos({photos:r.photo,personModelRegistry:h,photoModelRegistry:g,photoEngagementModelRegistry:u,photoStatsModelRegistry:m}),a=d.getValue(t.id,"photoContextList"),l=!!a.hasMinBoundary&&a.hasMinBoundary(),p=!!a.hasMaxBoundary&&a.hasMaxBoundary(),n=a.getList(),M=e.APIHelper.response.addOrReplaceListByContext({model:x,next:y,prev:c.reverse(),current:n,hasMin:l,hasMax:p,numNext:t.numNext,numPrev:t.numPrev}),d.setValue(t.id,"photoContextList",M),{next:y,previous:c.reverse()}}}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["gallery-models","photo-models","person-models","photo-engagement-models","photo-stats-models"]});YUI.add("flickr-galleries-addPhoto-creator",function(e,o){"use strict";e.namespace("ModelCreators")["flickr-galleries-addPhoto"]={run:function(t,l){var a={},s=t.galleryCompoundID?t.galleryCompoundID.split("-").pop():t.galleryID;return a.photo_id=t.photoID,a.gallery_id=s,e.Promise.all([l.callAPI("flickr.galleries.addPhoto",a),l.getModel("gallery-models",s),l.getModel("photo-models",t.photoID),l.getModelRegistry("photo-galleries-models"),l.getModelRegistry("photo-contexts-models"),l.getModelRegistry("gallery-photo-association-models"),l.getModelRegistry("gallery-info-models")]).then(function(o){var l,a,i=o[0],r=o[1],d=o[2],u=o[3],g=o[4],h=o[5],p=o[6];if("ok"===i.stat)return r&&!r.hasPhoto(d.getValue("id"))&&(r.addPhoto(d),d.getValue("isVideo")?r.setValue("videoCount",r.getValue("videoCount")+1):r.setValue("photoCount",r.getValue("photoCount")+1),1===r.getValue("photoCount")+r.getValue("videoCount")&&(l=d.getValue("sizes"),a={},e.Object.each(l,function(e,o){["m","s","sq","t"].indexOf(o)>-1&&(a[o]={width:e.width,height:e.height,src:e.url})}),r.setValue("primary",s),r.setValue("primaryPhotoSizes",a)),h.addOrUpdate({id:s+"-"+t.photoID,galleryId:s,photoId:t.photoId})),p.exists(s)&&!p.hasPhoto(s,d.getValue("id"))&&(p.getValue(s,"photoList").prependToList(d),d.getValue("isVideo")?p.setValue(s,"videoCount",p.getValue(s,"videoCount")+1):p.setValue(s,"photoCount",p.getValue(s,"photoCount")+1),p.getValue(s,"photoList").totalItems=p.getValue(s,"photoCount")+p.getValue(s,"videoCount"),p.getValue(s,"photoCount")+p.getValue(s,"videoCount")===1&&p.setValue(s,"primaryPhotoId",d.id)),u.exists(t.photoID)&&!u.getValue(t.photoID,"galleries").getFromListByID(r.getValue("id"))&&(u.getValue(t.photoID,"galleries").prependToList(r),u.setValue(t.photoID,"total",u.getValue(t.photoID,"total")+1)),g.exists(t.photoID)&&!g.getValue(t.photoID,"contexts").getFromListByID(r.getValue("id"))&&(g.setValue(t.photoID,"totalGalleries",g.getValue(t.photoID,"totalGalleries")+1),g.getValue(t.photoID,"contexts").appendToList(r)),r},e.FetcherErrorLogger(o))}}},"@VERSION@",{requires:["flickr-promise"],optional:["gallery-models","gallery-info-models","photo-models","photo-galleries-models","photo-contexts-models","gallery-photo-association-models"]});YUI.add("smart-galleries-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ListFetchers["flickr-galleries-getList"].run(t,this.appContext)},readNextGalleries:function(t,r){return e.ListFetchers["flickr-galleries-getList"].run(t,r)}},readNextGalleriesRemote:function(e,t){var r=t||{};return r.id=e,r.continuation=this.getValue(e,"continuation"),this.remote.readNextGalleries(r,this.appContext)},attributes:{id:{},pathAlias:{},galleries:{isCollection:!0,pageFetch:{listFetcher:e.ListFetchers["smart-galleries-getList"]}},continuation:{validator:function(t){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)},defaultValue:0},totalItems:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-galleries-getList-fetcher"]});YUI.add("flickr-galleries-getList-fetcher",function(e,o){"use strict";var t=1,r=500;e.namespace("ListFetchers")["flickr-galleries-getList"]={run:function(t,r,s){var a=this,i=this._processParams(t);return e.Promise.all([r.callAPI("flickr.galleries.getList",i),r.getModelRegistry("person-galleries-models"),r.getModelRegistry("gallery-models"),r.getModel("person-models",t.id||{pathAlias:t.pathAlias}),r.getModelRegistry("gallery-photo-association-models"),r.getModelRegistry("smart-galleries-models")]).then(function(e){return a._processResponse(e,t)},e.FetcherErrorLogger(o))},_processResponse:function(o,s){var a,i=o[0],l=o[1],n=o[2],p=o[3],d=o[4],c=o[5],g=i.galleries,u={},h=[],m={};if(g)return g.gallery&&e.Array.each(g.gallery,function(o,t){var r,s,a=o.hasRequestedPhotos,i=o.coverPhotos?o.coverPhotos.photo:[];r=o.id.split("-")[1],i.forEach(function(o){o.url=e.APIHelper.response.agnosticizeFarmPathTransferProtocol(o.url)}),s={id:r,compoundId:o.id,title:o.title.content,description:o.description.content,owner:p,primary:o.primaryPhotoId,primaryPhotoSizes:e.APIHelper.response.parsePrimaryPhotoSizes(o),photoCount:o.countPhotos,videoCount:o.countVideos,viewCount:o.countViews,commentCount:o.countComments,coverPhotosData:i},h.push(n.addOrUpdate(s)),a&&a.forEach(function(e){d.addOrUpdate({id:r+"-"+e,galleryId:r,photoId:e})})}),u={id:p.getValue("id"),pathAlias:p.getValue("pathAlias"),totalItems:g.total||g.gallery.length},a=s.perPage||r,m={perPage:a,page:s.page||t,pageContent:h,totalItems:g.total||g.gallery.length},g&&g.continuation?(u.continuation=g.continuation,c.addOrUpdate(u).getValue("galleries").appendToListMulti(h)):l.addOrUpdate(u).getValue("galleriesList").addPage(m),m.pageContent},_processParams:function(e){var o={primary_photo_extras:"url_sq, url_q, url_t, url_s, url_m",page:e.page||t,per_page:e.perPage||r,photo_ids:e.photoIds?e.photoIds.join():"",sort_groups:e.sortGroups?e.sortGroups.join():""};if(e.id)o.user_id=e.id;else{if(!e.pathAlias)throw new Error("[flickr-galleries-getList-fetcher] `id` or `pathAlias` is required.");o.path_alias=e.pathAlias}return void 0!==e.continuation?o.continuation=e.continuation:(o.cover_photos=e.coverPhotos||1,o.primary_photo_cover_size=e.primaryPhotoCoverSize||"m",o.cover_photos_size=e.coverPhotosSize||"q"),o}}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["person-galleries-models","gallery-models","person-models","gallery-photo-association-models","smart-galleries-models"]});YUI.add("person-galleries-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ListFetchers["flickr-galleries-getList"].run(t,this.appContext)}},attributes:{id:{},pathAlias:{},url:{readOnly:!0,derivedBy:["pathAlias","id"],getter:function(e,t){var r=this.getValue(t,"pathAlias");return r?"/photos/"+r+"/galleries":"/photos/"+t+"/galleries"}},galleriesList:{isCollection:!0,pageFetch:{listFetcher:e.ListFetchers["flickr-galleries-getList"]}},totalItems:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-galleries-getList-fetcher"]});YUI.add("flickr-galleries-create-creator",function(e,o){"use strict";e.namespace("ModelCreators")["flickr-galleries-create"]={run:function(t,l){var r={},s=[];return r.title=t.title,r.description=t.description,r.primary_photo_id=t.photoID,r.full_result=1,s=[l.callAPI("flickr.galleries.create",r),l.getModelRegistry("gallery-models"),l.getModel("person-models",l.getViewer().nsid),l.getModel("person-galleries-models",l.getViewer().nsid),l.getModelRegistry("photo-galleries-models"),l.getModelRegistry("photo-contexts-models")],t.photoID&&(s.push=l.getModel("photo-models",t.photoID)),e.Promise.all(s).then(function(o){var l,r,s=o[0],i=o[1],a=o[2],p=o[3],g=o[4],n=o[5],d=s.gallery.id,h=d.split("-")[1];return o.length>6&&(l=o[6]),!!h&&(r=i.add({id:h,compoundId:d,title:s.gallery.title.content,description:s.gallery.description.content,photoPageList:l?[l]:[],photoContextList:l?[l]:[],owner:a,primary:t.photoID,primaryPhotoSizes:e.APIHelper.response.parsePrimaryPhotoSizes(s.gallery),photoCount:l&&!l.getValue("isVideo")?1:0,videoCount:l&&l.getValue("isVideo")?1:0,viewCount:s.gallery.countViews,commentCount:s.gallery.countComments,coverPhotosData:s.gallery.coverPhotosData||[]}),p.getValue("galleriesList").prependToList(r),g.exists(t.photoID)&&!g.getValue(t.photoID,"galleries").getFromListByID(r.getValue("id"))&&(g.getValue(t.photoID,"galleries").prependToList(r),g.setValue(t.photoID,"total",g.getValue(t.photoID,"total")+1)),n.exists(t.photoID)&&!n.getValue(t.photoID,"contexts").getFromListByID(r.getValue("id"))&&(n.setValue(t.photoID,"totalGalleries",n.getValue(t.photoID,"totalGalleries")+1),n.getValue(t.photoID,"contexts").appendToList(r)),r)},e.FetcherErrorLogger(o))}}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["gallery-models","photo-models","person-models","person-galleries-models","photo-galleries-models","photo-contexts-models"]});YUI.add("gallery-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{langBundles:this.details.langBundles,name:this.name,remote:{read:function(t){return e.ListFetchers["flickr-galleries-getPhotos"].run(t,this.appContext)},create:function(t,r){return e.ModelCreators["flickr-galleries-create"].run(t,r)},addPhoto:function(t,r){return e.ModelCreators["flickr-galleries-addPhoto"].run(t,r)},removePhoto:function(t,r){return e.ModelCreators["flickr-galleries-removePhoto"].run(t,r)}},addPhoto:function(e,t){return this.getValue(e,"photoPageList").hasMaxBoundary()&&this.getValue(e,"photoPageList").appendToList(t),this.getValue(e,"photoContextList").hasMaxBoundary()&&this.getValue(e,"photoContextList").appendToList(t),this},removePhoto:function(e,t){return this.getValue(e,"photoPageList").removeFromList(t.getValue("id")),this.getValue(e,"photoContextList").removeFromList(t.getValue("id")),this},hasPhoto:function(e,t){return this.getValue(e,"photoPageList").getFromListByID(t)||this.getValue(e,"photoContextList").getFromListByID(t)},getPrimaryUrlToFit:function(t,r){this.getValue(t,"primaryPhotoSizes");var i=e.PhotoModelHelper.getSizeToFit(t,{height:r?r.width:75,width:r?r.height:75},e.merge({sizes:this.getValue(t,"primaryPhotoSizes"),includeSquare:!0,cropToFit:!0}));return i?i.src:""},attributes:{compoundId:{validator:function(t,r){return e.Lang.isString(t)&&t.indexOf("-")>-1}},displayType:{readOnly:!0,defaultFn:function(){return"gallery"}},title:{validator:function(t,r){return e.AttributeHelpers.validateString(t)},setter:function(t){var r=e.AttributeHelpers.coerceString(t);return r=r.replace(/\\'/,"'").replace(/\\"/,'"').replace(/\\\\/,"\\")},defaultValue:""},description:{validator:function(t,r){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)},defaultValue:""},owner:{isModel:!0},photoPageList:{isListProxy:!0,pageFetch:{listFetcher:e.ListFetchers["flickr-galleries-getPhotos"]}},photoContextList:{isListProxy:!0,contextFetch:{listFetcher:e.ListFetchers["flickr-galleries-getContext"],listItemIdField:"photoId"}},photoCount:{validator:function(t,r){return e.AttributeHelpers.validateInteger(t)},setter:function(t,r){return e.AttributeHelpers.coerceInteger(t)}},videoCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},itemCount:{readOnly:!0,derivedBy:["owner"],defaultFn:function(e){return this.getValue(e,"photoCount")+this.getValue(e,"videoCount")}},photoCountDisplay:{readOnly:!0,derivedBy:["owner"],defaultFn:function(e){var t=this.getValue(e,"photoCount"),r=this.getValue(e,"videoCount"),i="";return 0===(t-=r)&&0===r?i=this.intlMessage({intlName:"models.ZERO_PHOTOS"}):1===t&&0===r?i=this.intlMessage({intlName:"models.ONE_PHOTO"}):t>1&&0===r?i=this.intlMessage({intlName:"models.MULTIPLE_PHOTOS",photos:t}):0===t&&1===r?i=this.intlMessage({intlName:"models.ONE_VIDEO"}):1===t&&1===r?i=this.intlMessage({intlName:"models.ONE_PHOTO_AND_ONE_VIDEO"}):t>1&&1===r?i=this.intlMessage({intlName:"models.MULTIPLE_PHOTOS_AND_ONE_VIDEO",photos:t}):0===t&&r>1?i=this.intlMessage({intlName:"models.MULTIPLE_VIDEOS",videos:r}):1===t&&r>1?i=this.intlMessage({intlName:"models.ONE_PHOTO_AND_MULTIPLE_VIDEOS",videos:r}):t>1&&r>1&&(i=this.intlMessage({intlName:"models.MULTIPLE_PHOTOS_AND_MULTIPLE_VIDEOS",photos:t,videos:r})),i}},viewCount:{validator:function(t,r){return e.AttributeHelpers.validateInteger(t)},setter:function(t,r){return e.AttributeHelpers.coerceInteger(t)}},commentCount:{validator:function(t,r){return e.AttributeHelpers.validateInteger(t)},setter:function(t,r){return e.AttributeHelpers.coerceInteger(t)}},primary:{},primaryPhotoSizes:{},bestIconURL:{readOnly:!0,derivedBy:["primaryPhotoSizes"],defaultFn:function(e){return this.getPrimaryUrlToFit(e)||void 0}},url:{readOnly:!0,derivedBy:["owner"],defaultFn:function(e){var t=this.getValue(e,"owner");return t?"/photos/"+t.getValue("pathAlias")+"/galleries/"+e+"/":void 0}},urlSuffix:{readOnly:!0,derivedBy:["owner"],defaultFn:function(e){return"gallery-"+this.getValue(e,"owner").getValue("pathAlias")+"-"+e}},coverPhotosData:[]}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-galleries-getPhotos-fetcher","flickr-galleries-getContext-fetcher","flickr-galleries-addPhoto-creator","flickr-galleries-removePhoto-deletor","flickr-galleries-create-creator"],langBundles:["models"]});YUI.add("flickr-galleries-getPhotos-fetcher",function(e,o){"use strict";e.namespace("ListFetchers")["flickr-galleries-getPhotos"]={run:function(t,l){var r=this;return e.Promise.all([l.callAPI("flickr.galleries.getPhotos",this._processParams(t),!0),l.getModelRegistry("photo-models"),l.getModelRegistry("person-models"),l.getModelRegistry("gallery-models"),l.getModelRegistry("photo-engagement-models"),l.getModelRegistry("photo-stats-models"),l.getModelRegistry("gallery-info-models"),l.getModelRegistry("gallery-photo-models")]).then(function(e){return r._processResponse(e,t)},e.FetcherErrorLogger(o))},_processResponse:function(o,t){var l,r=o[0],s=o[1],a=o[2],g=o[3],i=o[4],n=o[5],p=o[6],d=o[7];if(r&&r.gallery)return r.gallery.owner=r.user,r.gallery.title=r.gallery.title&&r.gallery.title.content?r.gallery.title.content:r.gallery.title,r.gallery.description=r.gallery.description&&r.gallery.description.content?r.gallery.description.content:r.gallery.description,r.gallery.photoCount=r.gallery.countPhotos,r.gallery.videoCount=r.gallery.countVideos,e.APIHelper.response.addContextToRegistry(r.gallery,g,a),l=e.APIHelper.response.parsePhotos({photos:r.photos.photo,personModelRegistry:a,photoModelRegistry:s,photoEngagementModelRegistry:i,photoStatsModelRegistry:n}),g.setValue(t.id,"photoPageList",l),p.exists(t.id)&&p.getValue(t.id,"photoList").addPage({page:r.photos.page,perPage:r.photos.perpage,pageContent:l,totalItems:parseInt(r.photos.total||0,10)}),r.photos.photo.forEach(function(e,o){d.addOrUpdate({id:r.gallery.id+"-"+e.id,galleryId:r.gallery.id,photoId:e.id,remark:e.comment?e.comment._content:null})}),l},_processParams:function(o){return{gallery_id:o.id,extras:e.APIHelper.request.getRebootPhotoExtras(),per_page:o.perPage||1,page:o.page||1,get_user_info:1,get_gallery_info:1,primary_photo_extras:"url_sq, url_q, url_t, url_s, url_m"}}}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["photo-models","person-models","gallery-models","photo-engagement-models","photo-stats-models","gallery-info-models"]});YUI.add("gallery-info-models",function(e,t){function r(e){r.superclass.constructor.call(this,e)}e.Models[this.name]=r,e.extend(r,e.FlickrModelRegistry,{langBundles:this.details.langBundles,name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-galleries-getInfo"].run(t,this.appContext)},updateMeta:function(t,r){return e.ModelUpdaters["flickr-galleries-editMeta"].run(t,r)},delete:function(t,r){return e.ModelDeletors["flickr-galleries-delete"].run(t,r)},removePhoto:function(t,r){return e.ModelCreators["flickr-galleries-removePhoto"].run(t,r)},updatePrimaryPhoto:function(t,r){return e.ModelUpdaters["flickr-galleries-setPrimaryPhoto"].run(t,r)},updatePhotos:function(t,r){return e.ModelUpdaters["flickr-galleries-editPhotos"].run(t,r)}},updateMetaRemote:function(e,t){return t.galleryId=e,this.remote.updateMeta(t,this.appContext)},deleteRemote:function(e,t){return this.remote.delete(e,this.appContext)},getPrimaryPhotoUrl:function(t,r){return e.URLHelper.getFarmURL(this.getValue(t,"primary_photo_farm"),this.getValue(t,"primary_photo_server"),this.getValue(t,"primaryPhotoId"),this.getValue(t,"primary_photo_secret"),r)},hasPhoto:function(e,t){return this.getValue(e,"photoList").getFromListByID(t)},removePhotoRemote:function(e,t){return this.remote.removePhoto({galleryID:e,photoID:t},this.appContext)},updatePrimaryPhotoRemote:function(e,t){return this.remote.updatePrimaryPhoto({galleryId:e,photoId:t},this.appContext)},reorderPhotosRemote:function(t){var r=this.getValue(t,"photoList").getList().map(function(e){return e.id});return r.length!==this.getValue(t,"photoList").totalItems?e.Promise.reject("[gallery-info-models] `reorderPhotosRemote` was called without the entire set of photoIds."):this.remote.updatePhotos({galleryId:t,primaryPhotoId:this.getValue(t,"primaryPhotoId"),photoIds:r},this.appContext)},getCommentsByContinuation:function(t,r){return e.ListFetchers["flickr-galleries-comments-getList"].run({id:t,perPage:r,continuation:this.getValue(t,"commentsContinuation")},this.appContext)},attributes:{id:{validator:function(t){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},compoundId:{validator:function(t){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},url:{readOnly:!0,derivedBy:["owner","normalizedId"],defaultFn:function(t){var r=this.getValue(t,"owner"),i=e.URLHelper.generatePersonUrls(r);return r?i.galleries+"/"+t:void 0}},owner:{isModel:!0},username:{validator:function(t){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},primaryPhotoId:{validator:function(t){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},primaryPhotoSizes:{},dateCreate:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},dateUpdate:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},photoCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},videoCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},viewCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},commentCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},title:{validator:function(t){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},description:{validator:function(t){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},photoList:{isCollection:!0,pageFetch:{listFetcher:e.ListFetchers["flickr-galleries-getPhotos"]}},comments:{isCollection:!0},commentsContinuation:{validator:function(t){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)},defaultValue:"0"},primary_photo_server:{},primary_photo_farm:{},primary_photo_secret:{}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-galleries-getInfo-fetcher","flickr-galleries-getPhotos-fetcher","flickr-galleries-comments-getList-fetcher","flickr-galleries-editMeta-updater","flickr-galleries-delete-deletor","flickr-galleries-removePhoto-deletor","flickr-galleries-setPrimaryPhoto-updater","flickr-galleries-editPhotos-updater","url-helper"],langBundles:["models"]});YUI.add("flickr-galleries-getInfo-fetcher",function(e,r){"use strict";e.namespace("ModelFetchers")["flickr-galleries-getInfo"]={run:function(o,t){var n=this,s=this._processParams(o);return e.FlickrPromise({apiResponse:t.callAPI("flickr.galleries.getInfo",s),galleryInfoModelRegistry:t.getModelRegistry("gallery-info-models"),personModelRegistry:t.getModelRegistry("person-models")}).then(function(e){return n._processResponse(e,o,t)},e.FetcherErrorLogger(r))},_processResponse:function(e,r,o){var t,n,s=e.apiResponse,i=e.galleryInfoModelRegistry,a=(e.personModelRegistry,e.personModel,s.gallery);if(a)return o.getModel("person-models",a.owner).then(function(e){return n=e,t={id:r.id,compoundId:a.id,owner:n,username:a.username,primaryPhotoId:a.primary_photo_id,dateCreate:parseInt(a.date_create),dateUpdate:parseInt(a.date_update),photoCount:a.count_photos,videoCount:a.count_videos,viewCount:parseInt(a.count_views),commentCount:parseInt(a.count_comments),title:a.title._content,description:a.description._content,primary_photo_server:a.primary_photo_server,primary_photo_farm:a.primary_photo_farm,primary_photo_secret:a.primary_photo_secret},i.addOrUpdate(t)})},_processParams:function(e){return{gallery_id:e.id}}}},"@VERSION@",{requires:["flickr-promise","api-helper","url-helper"],optional:["gallery-info-models","person-models"]});YUI.add("notifications-view",function(t,i){require("hermes-core/flog")(i);t.namespace("Views")[this.name]=t.Base.create("notifications-view",t.FlickrView,[],{langBundles:this.details.langBundles,registries:{person:"person-models",photo:"photo-models",group:"group-info-models",gallery:"gallery-models"},initializer:function(t){var i=this.appContext.getViewer();return""===this.get("container").get("innerHTML")&&this.setContainerHTML(""),this.nsid=i&&i.signedIn?i.nsid:void 0,t.nsid=this.nsid,this.pageNum=0,this.pageSize=30,this.isFetchingNotifs=!1,this.scrollBottomLoadDist=300,this.endOfNotifs=!1,this.shouldFetchNotifs=t.shouldFetchNotifs,this.height=t.height,this.width=t.width,this.listHeight=t.listHeight,this.overflowX=t.overflowX,this.overflowY=t.overflowY,this.notifFilter=t.notifFilter,this},loadState:function(){return this},buildContainer:function(){return this.setContainerWithTemplate("notifications",{notifications:[],height:this.height,width:this.width,listHeight:this.listHeight,overflowX:this.overflowX,overflowY:this.overflowY}),this},activate:function(){var t,i,e,o,n,s=this;return s.scrollContainer=s.get("container").one(".notifications-list"),s.scrollContainerElement=this.scrollContainer.getDOMNode(),this.registerEventHandler(s.scrollContainer.on("scroll",s.handleScrollNotifications.bind(s))),s.get("personNotificationsModels")?s.getMoreNotifications():(t=this.appContext.getViewer(),this.appContext.getModel("person-notifications-models",t.nsid).then(function(t){s.set("personNotificationsModels",t),e=t.getValue("notifications").size(),o=t.getValue("unseenNotificationCount"),s.shouldFetchNotifs&&0!==o||0===e||t.getValue("muteChanged")?(s.shouldFetchNotifs=!1,t.setValue("unseenNotificationCount",0),t.setValue("muteChanged",!1),s.get("container").one(".notifications-list").addClass("loading"),s.getMoreNotifications()):(n=t.getValue("notifications").getList(),s.pageNum=Math.floor(e/s.pageSize),s.appendPage(n)),(i=t.getValue("unreadFlickrMailCount"))&&0!==i&&s.get("container").one(".flickr-mail-count").setHTML(s.intlMessage({intlName:"notifications.FLICKR_MAIL_COUNT_PAREN",count:i}))})),this},handleScrollNotifications:function(t){this.isFetchingNotifs||this.scrollContainerElement.offsetHeight+this.scrollContainerElement.scrollTop+this.scrollBottomLoadDist>=this.scrollContainerElement.scrollHeight&&this.getMoreNotifications()},getMoreNotifications:function(){this.endOfNotifs||(this.isFetchingNotifs=!0,this.showBalls(this.get("container").one(".notifications-list")),this.retrieveNotifsPage())},appendPage:function(i){var e=this;i.forEach(function(i){var o=i.toJSON();o.appContext=e.appContext,o.notifModel=e.get("personNotificationsModels"),o.events&&0!==o.events.length&&new t.Views["notification-view"](o).initialize(o).then(function(n){var s=t.Node.create('<li class="notification-list-item"></li>');e.get("container").one(".notifications-list").append(s),o.seen||s.addClass("unseen"),s.setHTML(n.get("container")),i.setValue("seen",!0),n.activate()})})},showBalls:function(i){this.balls||(this.balls=t.Node.create('<li class="loading-balls"></li>'),this.balls.setHTML(this.templates("flickr-balls")({}))),(i||this.get("container")).append(this.balls)},hideBalls:function(){this.balls&&this.balls.remove()},retrieveNotifsPage:function(){var t=this,i=t.get("personNotificationsModels");return i.getValue("notifications").getPage({page:t.pageNum+1,apiParams:{filter:t.notifFilter}}).then(function(e){return 0!==e.length?(t.pageNum++,t.set("personNotifications",i.getValue("notifications")),t.appendPage(e)):(0===t.pageNum&&t.get("container").one(".notifications-empty-state").removeClass("hidden"),t.endOfNotifs=!0),t.get("container").one(".notifications-list").removeClass("loading"),t.hideBalls(),t.isFetchingNotifs=!1,t},function(t){}).then(function(t){t.registerEventHandler(t.get("container").all("a").on("focus",function(i){var e=i.target.ancestor("li");e&&t.findFocus.call(this,e)}.bind(t)))})},findFocus:function(t){var i,e=t.one("a.photo");e?e.focus():(i=t.one("a:first-child"))&&i.focus()}})},"@VERSION@",{requires:["flickr-view","hermes-template-notifications"],langBundles:["common","notifications"],optional:["person-notifications-models","notification-view","photo-models","group-info-models","person-models","gallery-models"]});