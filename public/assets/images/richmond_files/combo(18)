YUI.add("flickr-subscriptions-braintree-deletePaymentMethod-deletor",function(e,r){"use strict";e.namespace("ModelDeletors")["flickr-subscriptions-braintree-deletePaymentMethod-deletor"]={run:function(t,i){var n={};return n.payment_method_id=t.id,e.Promise.all([i.callAPI("flickr.subscriptions.braintree.deletePaymentMethod",n)]).then(null,e.FetcherErrorLogger(r))},_processResponse:function(e,r){}}},"@VERSION@",{requires:["flickr-promise"],optional:[]});YUI.add("flickr-products-shipping-fetcher",function(e,r){"use strict";e.namespace("ModelFetchers")["flickr-products-shipping"]={run:function(s,t){var o=this;return e.Promise.all([t.callAPI("flickr.products.orders.getShippingAddress",this._processParams(s)),t.getModelRegistry("products-address-models")]).then(function(e){return o._processResponse(e,s)},e.FetcherErrorLogger(r))},_processResponse:function(e,r){var s,t,o;t=e&&e[0]&&e[0].orderInfo&&e[0].orderInfo.shippingAddress?e[0].orderInfo.shippingAddress:{},o={orderId:e[0].orderInfo.orderId,id:r.id,city:t.city||"",countryCode:t.countryCode||"US",firstName:t.firstName||"",lastName:t.lastName||"",phone:t.phone||"",postalCode:t.postalCode||"",state:t.state||"",street1:t.street1||"",street2:t.street2||""},(s=e[1]).exists(r.id)?(delete o.id,s.setValues(r.id,o)):s.add(o)},_processParams:function(e){var r={};return r.order_id=e.id,r}}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["products-address-models"]});YUI.add("flickr-products-orders-setShippingAddress-updater",function(r,e){"use strict";function t(r){var e;if(!r||!r.orderInfo)throw new Error(-2);if(void 0!==(e=r.orderInfo).isValidAddress&&"false"===e.isValidAddress)throw new Error(-1);return!0}r.namespace("ModelUpdaters")["flickr-products-orders-setShippingAddress"]={run:function(s,o){var i,d=s;return i={order_id:d.id,first_name:d.firstName,last_name:d.lastName,street1:d.street1,street2:d.street2,city:d.city,state:d.state,postal_code:d.postalCode,country_code:d.countryCode||"US",phone:d.phone,shipping_type:d.shippingType},o.callAPI("flickr.products.orders.setShippingAddress",i).then(t,r.FetcherErrorLogger(e))}}},"@VERSION@",{requires:["flickr-promise"],optional:[]});YUI.add("flickr-products-orders-clearAddress-deletor",function(r,e){"use strict";function s(r){return!0}r.namespace("ModelDeletors")["flickr-products-orders-clearAddress"]={run:function(t,d){var o;return o={order_id:t.orderId,first_name:"",last_name:"",street1:"",street2:"",city:"",state:"",postal_code:"",country_code:"US",phone:"",clear_shipping_address:1},d.callAPI("flickr.products.orders.setShippingAddress",o).then(s,r.FetcherErrorLogger(e))}}},"@VERSION@",{requires:["flickr-promise"],optional:[]});YUI.add("products-address-models",function(t){function e(t){e.superclass.constructor.call(this,t)}t.Models[this.name]=e,t.extend(e,t.FlickrModelRegistry,{name:this.name,remote:{read:function(e){return t.ModelFetchers["flickr-products-shipping"].run(e,this.appContext)},update:function(e,r){var n={},i=this;return Object.keys(this.attributes).forEach(function(t){n[t]=void 0!==r[t]?r[t].newVal:i.getValue(e,t)}),this.appContext.getModel("flickr-products-orders-models",e).then(function(e){return n.shippingType=e.getValue("shippingType"),t.ModelUpdaters["flickr-products-orders-setShippingAddress"].run(n,i.appContext)})},delete:function(e){return t.ModelDeletors["flickr-products-orders-clearAddress"].run({orderId:this.getValue(e,"orderId")},this.appContext)}},isComplete:function(t){var e=Object.keys(this.attributes),r=["cacheBust","street2"],n=this.proxy(t);return e.every(function(t){return!(r.indexOf(t)<0&&""===n.getValue(t))})},attributes:{cacheBust:{},orderId:{getter:function(t){return t||""},validator:function(e){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)}},firstName:{getter:function(t){return t||""},validator:function(e){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)}},lastName:{getter:function(t){return t||""},validator:function(e){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)}},street1:{getter:function(t){return t||""},validator:function(e){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)}},street2:{getter:function(t){return t||""},validator:function(e){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)}},city:{getter:function(t){return t||""},validator:function(e){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)}},state:{getter:function(t){return t||""},validator:function(e){return t.AttributeHelpers.validateString(e)},setter:function(e){var r;return 2===(r=t.AttributeHelpers.coerceString(e)).length&&(r=r.toUpperCase()),r}},postalCode:{getter:function(t){return t||""},validator:function(e){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)}},countryCode:{getter:function(t){return t||""},validator:function(e){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)},defaultValue:"US"},phone:{getter:function(t){return t||""},validator:function(e){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)}}}})},"@VERSION@",{requires:["flickr-model-registry"],optional:["flickr-products-shipping-fetcher","flickr-products-orders-setShippingAddress-updater","flickr-products-orders-clearAddress-deletor"]});YUI.add("products-credit-card-models",function(t){function e(t){e.superclass.constructor.call(this,t)}t.Models[this.name]=e,t.extend(e,t.FlickrModelRegistry,{name:this.name,remote:{delete:function(e){return t.ModelDeletors["flickr-subscriptions-braintree-deletePaymentMethod-deletor"].run({id:e},this.appContext)},update:function(e,r){if("isDefault"in r)return t.ModelUpdaters["flickr-products-braintree-paymentDefault-updater"].run({id:e},this.appContext)}},attributes:{type:{validator:function(e,r){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)||void 0},defaultFn:function(t){return""}},typeString:{validator:function(e,r){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e).toLowerCase()||void 0},defaultFn:function(t){return""}},last4:{validator:function(e,r){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)||void 0},defaultFn:function(t){return""}},expirationMonth:{validator:function(e,r){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)||void 0},defaultFn:function(t){return""}},expirationYear:{validator:function(e,r){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)||void 0},defaultFn:function(t){return""}},firstName:{validator:function(e,r){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)||void 0},defaultFn:function(t){return""}},lastName:{validator:function(e,r){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)||void 0},defaultFn:function(t){return""}},isDefault:{validator:function(e,r){return t.AttributeHelpers.validateBoolean(e)},setter:function(e){return t.AttributeHelpers.coerceBoolean(e)||void 0},defaultFn:function(t){return!1}},isExpired:{validator:function(e,r){return t.AttributeHelpers.validateBoolean(e)},setter:function(e){return t.AttributeHelpers.coerceBoolean(e)||void 0},defaultValue:!1},subscriptionType:{validator:function(e,r){return t.AttributeHelpers.validateInteger(e)},setter:function(e){return t.AttributeHelpers.coerceInteger(e)||void 0},defaultFn:function(t){return-1}},address:{isModel:!0}}})},"@VERSION@",{requires:["flickr-subscriptions-braintree-deletePaymentMethod-deletor","flickr-products-braintree-paymentDefault-updater","products-address-models"]});YUI.add("flickr-braintree-close-deletor",function(e,r){"use strict";e.namespace("ModelDeletors")["flickr-braintree-close-deletor"]={run:function(l,c){return c.callAPI("flickr.subscriptions.braintree.close",l).then(null,e.FetcherErrorLogger(r))}}},"@VERSION@",{requires:["flickr-promise"]});YUI.add("flickr-subscriptions-changePlan-updater",function(r,e){"use strict";r.namespace("ModelUpdaters")["flickr-subscriptions-changePlan-updater"]={run:function(n,c){return c.callAPI("flickr.subscriptions.changePlan",n).then(null,r.FetcherErrorLogger(e))}}},"@VERSION@",{requires:["flickr-promise"]});YUI.add("subscription-history-models",function(t){function e(t){e.superclass.constructor.call(this,t)}t.Models[this.name]=e,t.extend(e,t.FlickrModelRegistry,{name:this.name,remote:{update:function(e,r){return t.ModelUpdaters["flickr-subscriptions-changePlan-updater"].run({current_plan_type:r.type.prevVal,new_plan_type:r.type.newVal},this.appContext)},delete:function(e,r){return t.ModelDeletors["flickr-braintree-close-deletor"].run({subscription_id:e},this.appContext)}},attributes:{startDate:{validator:function(e,r){return!(parseInt(e,10)>0)||t.AttributeHelpers.validateDate(e)},setter:function(e){if(parseInt(e,10)>0)return t.AttributeHelpers.coerceDate(e)||void 0},serialize:function(t){return t.format("X")},deserialize:function(e){return t.moment(e,"X")},defaultFn:function(t){}},nextBillingDate:{validator:function(e,r){return!(parseInt(e,10)>0)||t.AttributeHelpers.validateDate(e)},setter:function(e){if(parseInt(e,10)>0)return t.AttributeHelpers.coerceDate(e)||void 0},serialize:function(t){return t.format("X")},deserialize:function(e){return t.moment(e,"X")},defaultFn:function(t){}},effectiveEndDate:{validator:function(e,r){return!(parseInt(e,10)>0)||t.AttributeHelpers.validateDate(e)},setter:function(e){if(parseInt(e,10)>0)return t.AttributeHelpers.coerceDate(e)||void 0},serialize:function(t){return t.format("X")},deserialize:function(e){return t.moment(e,"X")},defaultFn:function(t){}},billingScheduleMonths:{validator:function(e,r){return t.AttributeHelpers.validateInteger(e)},setter:function(e){return t.AttributeHelpers.coerceInteger(e)||void 0},defaultFn:function(t){return 0}},type:{validator:function(e,r){return t.AttributeHelpers.validateInteger(e)},setter:function(e){return t.AttributeHelpers.coerceInteger(e)||void 0},defaultFn:function(t){return-1}},paymentMethodId:{validator:function(e,r){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)||void 0},defaultFn:function(t){return""}},prettyName:{validator:function(e,r){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)||void 0},defaultFn:function(t){return""}},prettyNameDuration:{validator:function(e,r){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)||void 0},defaultFn:function(t){return""}},status:{validator:function(e,r){return t.AttributeHelpers.validateInteger(e)},setter:function(e){return t.AttributeHelpers.coerceInteger(e)||void 0},defaultFn:function(t){return-1}},amountBilled:{validator:function(e,r){return t.AttributeHelpers.validateFloat(e)},setter:function(e){return t.AttributeHelpers.coerceFloat(e)||void 0},defaultFn:function(t){return 0}},pendingPrice:{validator:function(e,r){return t.AttributeHelpers.validateFloat(e)},setter:function(e){return t.AttributeHelpers.coerceFloat(e)||void 0},defaultFn:function(t){return 0}},transactions:{}}})},"@VERSION@",{requires:["flickr-braintree-customerDetails-fetcher","flickr-braintree-close-deletor","flickr-subscriptions-changePlan-updater"]});YUI.add("subscription-history-list-models",function(e){function r(e){r.superclass.constructor.call(this,e)}e.Models[this.name]=r,e.extend(r,e.FlickrModelRegistry,{name:this.name,remote:{read:function(r){return e.ModelFetchers["flickr-braintree-customerDetails-fetcher"].run(r,this.appContext)}},attributes:{subscriptions:{isListProxy:!0},oneTimePro:{}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-braintree-customerDetails-fetcher"]});YUI.add("flickr-braintree-customerDetails-fetcher",function(e,t){"use strict";var s=require("hermes-core/flog")(t),a={1:"Visa",2:"MasterCard",3:"Discover",4:"AmEx",5:"JCB"};e.namespace("ModelFetchers")["flickr-braintree-customerDetails-fetcher"]={run:function(s,a){var i=this,r=this._processParams(s);return e.Promise.all([a.callAPI("flickr.subscriptions.braintree.getCustomerDetails",r,!0),a.getModelRegistry("products-payment-methods-list-models"),a.getModelRegistry("products-credit-card-models"),a.getModelRegistry("products-paypal-payment-models"),a.getModelRegistry("products-address-models"),a.getModelRegistry("subscription-history-list-models"),a.getModelRegistry("subscription-history-models")]).then(function(e){return i._processResponse(e,s,a)},e.PromiseCatcher(t))},_processParams:function(e){return{account_id:e.id}},_processResponse:function(t,i,r){var o,d,n,l,p=t[0],c=t[1],u=t[2],m=t[3],y=t[4],f=t[5],h=t[6],M={},D={};p&&p.customerDetails&&(p.customerDetails.braintreePaymentMethods&&(n=p.customerDetails.braintreePaymentMethods),p.customerDetails.paypalPaymentMethods&&(l=p.customerDetails.paypalPaymentMethods)),d=p.customerDetails.subscriptions,(o=p.customerDetails.addresses)&&o instanceof Array&&o.forEach(function(e){var t={};t={firstName:e.firstName,lastName:e.lastName,street1:e.street1,street2:e.street2,city:e.city,state:e.state,postalCode:e.postalCode,countryCode:e.countryCode,phone:e.phone},y.exists(e.id)?y.setValues(e.id,t):(t.id=e.id,y.add(t))}),n&&n instanceof Array&&(M.cards=n.map(function(t){var s={};return s.type=t.cardType,s.typeString=a[t.cardType]||"",s.last4=t.paymentVendorCreditCardLastFour,s.expirationMonth=t.cardExpireMonth,s.expirationYear=t.cardExpireYear,s.isDefault=e.AttributeHelpers.coerceBoolean(t.isDefault),s.isExpired=e.moment(s.expirationYear+"-"+s.expirationMonth+"-01","YYYY-MM-DD").isBefore(),s.isDefault&&(M.defaultPaymentMethod=t.id),y.exists(t.billingAddressId)&&(s.address=y.proxy(t.billingAddressId)),u.exists(t.id)?(u.setValues(t.id,s),u.proxy(t.id)):(s.id=t.id,u.add(s))})),l&&(M.paypalPaymentMethods=l.map(function(t){var s={};return t.typeString="paypal",t.isDefault=e.AttributeHelpers.coerceBoolean(t.isDefault),t.email=unescape(t.email),t.isDefault&&(M.defaultPaymentMethod=t.id),s.dateCreate=1e3*t.dateCreate,s.dateUpdate=1e3*t.dateUpdate,s.firstName=t.firstName,s.lastName=t.lastName,s.email=t.email,s.isDefault=t.isDefault,s.typeString=t.typeString,m.exists(t.id)?(m.setValues(t.id,s),m.proxy(t.id)):(s.id=t.id,m.add(s))})),d&&d instanceof Array&&(D.subscriptions=d.map(function(t){var a={};return t.status=parseInt(t.status,10),t.type=parseInt(t.type,10),2!==t.status&&7!==t.status&&12!==t.status||(u.exists(t.paymentMethodId)?(u.setValue(t.paymentMethodId,"subscriptionType",t.type),M.linkedPaymentMethod=t.paymentMethodId):m.exists(t.paymentMethodId)?(m.setValue(t.paymentMethodId,"subscriptionType",t.type),M.linkedPaymentMethod=t.paymentMethodId):s.info("Subscription tied to a payment method that does not exist.")),a.startDate=1e3*t.startDate,a.billingScheduleMonths=t.billingScheduleMonths,a.nextBillingDate=1e3*t.nextBillingDate,a.effectiveEndDate=1e3*t.effectiveEndDate,a.type=t.type,a.paymentMethodId=t.paymentMethodId,a.status=t.status,a.amountBilled=t.amountBilled,a.transactions=t.transactions,a.prettyName=t.planInfo.prettyName,a.prettyNameDuration=t.planInfo.prettyNameDuration,a.pendingPrice=t.pendingPrice||void 0,e.Array.each(a.transactions,function(t){t.formattedCreateDate=e.moment(t.dateCreate,"X").format("MMM Do, YYYY"),t.isRefund=!1,3===parseInt(t.transactionType,10)&&(t.isRefund=!0)}),h.exists(t.id)?(h.setValues(t.id,a),h.proxy(t.id)):(a.id=t.id,h.add(a))}),p.customerDetails.paymentHistory&&(D.oneTimePro=p.customerDetails.paymentHistory.proStatus)),f.exists(i.id)?f.setValues(i.id,D):(D.id=i.id,f.add(D)),c.exists(i.id)?c.setValues(i.id,M):(M.id=i.id,c.add(M))}}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["products-payment-methods-list-models","products-credit-card-models","subscription-history-models","subscription-history-list-models","products-address-models"]});YUI.add("products-payment-methods-list-models",function(t){function e(t){e.superclass.constructor.call(this,t)}t.Models[this.name]=e,t.extend(e,t.FlickrModelRegistry,{name:this.name,remote:{read:function(e){return t.ModelFetchers["flickr-braintree-customerDetails-fetcher"].run(e,this.appContext)},create:function(e){return t.ModelCreators["flickr-braintree-createSubscription-create"].run(e,this.appContext)},update:function(e,r){return"defaultPaymentMethod"in r?t.ModelUpdaters["flickr-products-braintree-paymentDefault-updater"].run({payment_method_id:r.defaultPaymentMethod.newVal},this.appContext):"linkedPaymentMethod"in r?t.ModelUpdaters["flickr-subscriptions-transferSubscriptions-updater"].run({old_payment_method_id:r.linkedPaymentMethod.prevVal,new_payment_method_id:r.linkedPaymentMethod.newVal},this.appContext):void 0}},attributes:{cards:{isListProxy:!0},paypalPaymentMethods:{isListProxy:!0},defaultPaymentMethod:{validator:function(e,r){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)||void 0},defaultFn:function(t){return""}},linkedPaymentMethod:{validator:function(e,r){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)||void 0},defaultFn:function(t){return"1"}}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-braintree-customerDetails-fetcher","flickr-braintree-createSubscription-creator","flickr-subscriptions-transferSubscriptions-updater","flickr-products-braintree-paymentDefault-updater"]});YUI.add("account-menu-view",function(e,t){"use strict";var o=require("hermes-core/flog")(t);e.namespace("Views")[this.name]=e.Base.create("account-menu-view",e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this},loadState:function(){var t=this,o=[],n=this.appContext.getViewer();return n.signedIn?(t.set("user",{signedIn:!0,csrf:this.appContext.auth.csrf?this.appContext.auth.csrf:""}),o.push(this.appContext.getModel("person-models",n.nsid).then(function(o){var n=o.toJSON();Object.keys(n.buddyicon||{}).forEach(function(e){n.buddyicon[e]||(n.buddyicon[e]=n.buddyicon.default)}),t.set("user",e.merge(t.get("user"),n))})),o.push(t.appContext.getModel("person-profile-models",n.nsid).then(function(o){var n=o.toJSON();n.unreadMessages=parseInt(n.unreadMessages,10),n.storageUsed=parseInt(n.storageUsed,10),t.get("user").isPro&&!t.appContext.flipper.isFlipped("enable-new-pro")?t.get("user").hasAdfree||t.get("user").has1TB||t.get("user").has2TB?n.storageTotal=parseInt(n.storageTotal,10):n.storageTotal=-1:n.storageTotal=parseInt(n.storageTotal,10),t.set("user",e.merge(t.get("user"),n))})),e.Promise.all(o)):(t.set("user",{signedIn:!1}),e.Promise.resolve())},buildContainer:function(){return this.setContainerWithTemplate("account-menu",this.toJSON()),this},toJSON:function(){var t=e.merge(this.get("user")),o=this.appContext.lang;return parseInt(t.photoCount,10)>1?t.pluralPhotos=!0:t.pluralPhotos=!1,parseInt(t.photoCount,10)<1&&(t.photoCount=!1),t.photoCount>1e3&&(t.photoCount=Math.round(t.photoCount/1e3),t.oneK=!0),this.appContext.flipper.isFlipped("enable-new-pro")?t.hasUnlimitedStorage?t.storageTotalFormatted="":t.has1TB?t.storageTotalFormatted="1TB":t.has2TB?t.storageTotalFormatted="2TB":t.storageTotalFormatted=t.storageTotal<0?"":e.Handlebars.helpers.friendlyDataSize(t.storageTotal):t.storageTotalFormatted=t.storageTotal<0?"":e.Handlebars.helpers.friendlyDataSize(t.storageTotal),"zh-Hant-HK"===o&&(o="zh-HK"),"vi-vn"===o.toLowerCase()&&(o="vn-VN"),t.storageUsedPercentage=Math.floor(1e3*t.storageUsed/t.storageTotal)/10||"0.0",t.storageUsedFormatted=e.Handlebars.helpers.friendlyDataSize(t.storageUsed),t.barWidth=Math.floor(t.storageUsedPercentage/100*293),t.unreadMessages=t.unreadMessages>9999?"9999+":t.unreadMessages,{user:t,helpLocaleKey:o.replace("-","_")||"en_US",flippers:this.appContext.flipper.toJSON()}},activate:function(){setTimeout(function(){this.get("container").on(["click","keydown"],function(e){"click"!==e.type&&13!==e.keyCode&&32!==e.keyCode||(!this.accountMenuDialog||this.accountMenuDialog.isClosed?this.openMenu(e):this.closeMenu(e))},this)}.bind(this),350)},openMenu:function(t){var o,n=this.get("container");return t.preventDefault(),t.stopPropagation(),this.fire("open"),this.accountMenuDialog||(o=this.templates("account-menu-card"),this.accountMenuDialog=new e.Views.FluidDroparound({appContext:this.appContext,dismissOnOverlayClick:!0,showDropArrow:!0,showOverlay:!1,width:322,height:"auto",anchorOffsetHorizontal:5,observePageResize:!0,anchorElement:n.one(".c-account-menu"),keyboardAnchorElement:n.one("a[aria-haspopup=true]"),htmlMessage:o({attrs:this.toJSON()}),positionFixed:!0}),this.appContext.flipper.isFlipped("enable-new-pro")&&this.showGetProButton()),this.accountMenuDialog.show(),this.appContext.flipper.isFlipped("enable-new-pro")&&this.on("open",this.showGetProButton),this},closeMenu:function(e){e&&e.preventDefault(),this.accountMenuDialog&&this.accountMenuDialog.close()},showGetProButton:function(){var t=!1,n=!1,s=[],a=this.appContext.getViewer();s.push(this.appContext.getModel("subscription-info-models",a.nsid).then(function(e){e.getValue("products").forEach(function(e){e.canPurchase&&(t=!0)}),!t&&this.accountMenuDialog.get("container").one(".upgrade")&&this.accountMenuDialog.get("container").one(".upgrade").remove(!0)}.bind(this))),s.push(this.appContext.getModel("subscription-history-list-models",a.nsid).then(function(e){e.getValue("subscriptions")&&(e.getValue("subscriptions").toJSON().forEach(function(e){!e.effectiveEndDate&&!e.nextBillingDate||3!==e.status&&12!==e.status||(n=!0)}),this.get("user").hasUnlimitedStorage&&(n=!0))}.bind(this))),e.Promise.all(s).then(function(){var e=this.templates("account-menu-card-get-pro-button")({canPurchase:!n&&t,canResubscribe:n});this.accountMenuDialog.get("container").one(".upgrade").replace(e),this.accountMenuDialog.get("container").one(".content").setStyles({height:"auto"})}.bind(this),function(e){o.warn("Error fetching model.",{err:e})})},destructor:function(){this.accountMenuDialog&&(this.accountMenuDialog.destroy(),this.accountMenuDialog=null)}})},"@VERSION@",{requires:["flickr-view","hermes-template-account-menu","hermes-template-account-menu-dialog-styleguide","hermes-template-account-menu-card","hermes-template-account-menu-card-get-pro-button","fluid-droparound-view","subscription-history-list-models"],optional:["person-models","person-profile-models"],langBundles:["account-menu","common","autosuggest"]});YUI.add("hermes-lang-account-menu",function(o,e){o.Intl.add("hermes/account-menu","en-US",{SPACE_USED:["Using ","${percentage}","% of ","${total}"],SPACE_USED_STYLEGUIDE:["${percentage}","% used of ","${total}"],SPACE_USED_UNLIMITED:["Using ","${used}"," of your unlimited storage"],PHOTO_COUNT_MANY:[{type:"number",valueName:"num"}," photos"],PHOTO_COUNT_ONE:["One photo"],PHOTO_COUNT_NONE:["No photos"],PHOTO_COUNT_1K:[{type:"number",valueName:"num"},"k photos"],ADDMORESPACE:["Add more space"],GOADFREE:["Go Ad Free"],GOPRO:["Go Pro"],GETPRO:["Get Pro"],RESUBSCRIBE_TO_PRO:["Re-subscribe to Pro"],GREETING_CAPTION_SPANISH:["Now you know how to greet people in Spanish"],GREETING_CAPTION_GERMAN:["Now you know how to greet people in German"],GREETING_CAPTION_AUSTRALIAN:["Now you know how to greet people in Australian"],GREETING_CAPTION_DUTCH:["Now you know how to greet people in Dutch"],GREETING_CAPTION_ENGLISH:["Now you know how to greet people in English"],GREETING_CAPTION_ARABIC:["Now you know how to greet people in Arabic"],GREETING_CAPTION_FRENCH:["Now you know how to greet people in French"],GREETING_CAPTION_ITALIAN:["Now you know how to greet people in Italian"],GREETING_CAPTION_SWEDISH:["Now you know how to greet people in Swedish"],GREETING_CAPTION_HAWAIIAN:["Now you know how to greet people in Hawaiian"],GREETING_CAPTION_TAGALOG:["Now you know how to greet people in Tagalog"],GREETING_CAPTION_HEBREW:["Now you know how to greet people in Hebrew"],GREETING_CAPTION_HINDI:["Now you know how to greet people in Hindi"],GREETING_CAPTION_MANDARIN:["Now you know how to greet people in Mandarin"],GREETING_CAPTION_PORTUGUESE:["Now you know how to greet people in Portuguese"],GREETING_CAPTION_ALBANIAN:["Now you know how to greet people in Albanian"],GREETING_CAPTION_ESTONIAN:["Now you know how to greet people in Estonian"],GREETING_CAPTION_GREEK:["Now you know how to greet people in Greek"],GREETING_CAPTION_HUNGARIAN:["Now you know how to greet people in Hungarian"],GREETING_CAPTION_LINGALA:["Now you know how to greet people in Lingala"],GREETING_CAPTION_SWAHILI:["Now you know how to greet people in Swahili"],GREETING_CAPTION_TSHILUBA:["Now you know how to greet people in Tshiluba"],GREETING_CAPTION_TURKISH:["Now you know how to greet people in Turkish"],GREETING_CAPTION_BURMESE:["Now you know how to greet people in Burmese"],GREETING_CAPTION_ICELANDIC:["Now you know how to greet people in Icelandic"],GREETING_CAPTION_ZULU:["Now you know how to greet people in Zulu"],GREETING_CAPTION_KOREAN:["Now you know how to greet people in Korean"],GREETING_CAPTION_IRISH:["Now you know how to greet people in Irish"],GREETING_CAPTION_LATVIAN:["Now you know how to greet people in Latvian"],GREETING_CAPTION_BASQUE:["Now you know how to greet people in Basque"],GREETING_CAPTION_BENGALI:["Now you know how to greet people in Bengali"],GREETING_CAPTION_BULGARIAN:["Now you know how to greet people in Bulgarian"],GREETING_CAPTION_CROATIAN:["Now you know how to greet people in Croatian"],GREETING_CAPTION_CZECH:["Now you know how to greet people in Czech"],GREETING_CAPTION_DANISH:["Now you know how to greet people in Danish"],GREETING_CAPTION_FINNISH:["Now you know how to greet people in Finnish"],GREETING_CAPTION_HOPI:["Now you know how to greet people in Hopi"],GREETING_CAPTION_INDONESIAN:["Now you know how to greet people in Indonesian"],GREETING_CAPTION_KANNADA:["Now you know how to greet people in Kannada"],GREETING_CAPTION_KURDISH:["Now you know how to greet people in Kurdish"],GREETING_CAPTION_LITHUANIAN:["Now you know how to greet people in Lithuanian"],GREETING_CAPTION_MALAYSIAN:["Now you know how to greet people in Malaysian"],GREETING_CAPTION_NORWEGIAN:["Now you know how to greet people in Norwegian"],GREETING_CAPTION_POLISH:["Now you know how to greet people in Polish"],GREETING_CAPTION_ROMANIAN:["Now you know how to greet people in Romanian"],GREETING_CAPTION_RUSSIAN:["Now you know how to greet people in Russian"],GREETING_CAPTION_SERBIAN:["Now you know how to greet people in Serbian"],GREETING_CAPTION_SLOVAKIAN:["Now you know how to greet people in Slovakian"],GREETING_CAPTION_UKRAINIAN:["Now you know how to greet people in Ukrainian"],GREETING_CAPTION_VIETNAMESE:["Now you know how to greet people in Vietnamese"]})},"@VERSION@",{requires:["intl"]});