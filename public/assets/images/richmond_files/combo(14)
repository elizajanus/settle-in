YUI.add("notifications-menu-view",function(t){"use strict";t.namespace("Views")[this.name]=t.Base.create("notifications-menu-view",t.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){return this.pollingFailed=!1,this.shouldFetchNotifs=!0,this.notifFilter=["group_topic_new","user_gallery_comment"].join(","),""===this.get("container").get("innerHTML")&&this.setContainerWithTemplate("notifications-menu"),this},loadState:function(){var e=this,i=this.appContext.getViewer();return this.appContext.getModel("person-notifications-models",i.nsid).then(function(n){if(e.set("personNotificationsModel",n),Date.now()-n.getValue("unseenLastFetchedTimestamp")>t.config.flickr.notifications.loading_count_refetch_delay)return n.remoteReadUnseenNotificationCount({id:i.nsid,filter:e.notifFilter},e.appContext).then(null,function(t){e.pollingFailed=!0})})},buildContainer:function(){var t=this.formatCount99(this.get("personNotificationsModel").getValue("unseenNotificationCount"));return this.setContainerWithTemplate("notifications-menu",{unseenNotificationCount:t}),this},activate:function(){var t=this.get("personNotificationsModel");this.unseenBadge=this.get("container").one(".c-notification-unseencount"),this.unseenCount=0,this.notifIcon=this.get("container").one(".c-notification-icon"),0===t.getValue("unseenNotificationCount")?this.unseenBadge.addClass("hidden"):this.unseenBadge.removeClass("hidden"),this.registerEventHandler(this.get("container").on("click",this.openMenu.bind(this))),this.registerEventHandler(this.get("container").on("key",this.keyboardToggleMenu.bind(this),"down:13,32")),this.registerEventHandler(this.get("container").on("key",this.enterMenu.bind(this),"down:9,40")),this.pollForUnseenNotifs()},pollForUnseenNotifs:function(){this.pollIntervalId=setInterval(this.readUnseenNotifs.bind(this),t.config.flickr.notifications.polling_delay)},readUnseenNotifs:function(){var e=this,i=this.appContext.getViewer();e.get("personNotificationsModel").remoteReadUnseenNotificationCount({id:i.nsid,filter:e.notifFilter},e.appContext).then(function(t){e.shouldFetchNotifs=!0,t!==e.unseenCount&&(e.unseenCount=t,0!==t?(e.unseenBadge.removeClass("hidden"),e.unseenBadge.set("text",e.formatCount99(t))):e.unseenBadge.addClass("hidden"))},function(i){clearInterval(e.pollIntervalId),e.pollingFailed||(e.pollingFailedTimeoutId=setTimeout(e.pollForUnseenNotifs.bind(e),t.config.flickr.notifications.polling_failure_timeout)),e.pollingFailed=!0})},openMenu:function(){this.revealNotifications()},keyboardToggleMenu:function(t){t.preventDefault(),!this.droparound||this.droparound.isClosed?this.revealNotifications():this.droparound.close()},enterMenu:function(t){var e=t.keyCode;if(9===e&&!t.shiftKey&&"true"===t.target.getAttribute("aria-expanded")||40===e){t.preventDefault();var i=this.droparound.get("container").one("div.notifs-droparound");if(i){var n=i.one("a.mail-icon");this.registerEventHandler(n.on("key",this.enterNotificationsList.bind(this),"down:9,40")),n.focus()}}},enterNotificationsList:function(t){var e=t.keyCode;(9===e&&!t.shiftKey||40===e)&&(t.preventDefault(),this.droparound.get("subview").findFocus.call(this,this.droparound.get("container").one("div.notifs-droparound").one("ul").one("li:not(.hidden)")))},revealNotifications:function(){var e,i=this.appContext.viewportData.getWidth(),n=this.appContext.viewportData.getHeight(),o=i>700?60:67,s=i>700?"":i-2+"px",a=n>1e3?"800px":n-200+"px";(e=new t.Views["notifications-view"]({appContext:this.appContext,width:s,listHeight:a,shouldFetchNotifs:this.shouldFetchNotifs,notifFilter:this.notifFilter})).appContext=this.appContext,this.droparound=new t.Views.FluidDroparound({appContext:this.appContext,dismissOnOverlayClick:!0,dismissOnActionClick:!0,anchorOffsetVertical:-4,anchorOffsetHorizontal:o,mirrorArrowAdjustment:o-11,showDropArrow:!0,contentPadding:0,classList:"notifs-droparound no-border big-shadow",anchorElement:this.get("container").one(".c-notification-icon"),subview:e,observePageResize:!0,positionFixed:!0,autoSizeToContent:!0,preventPageScrollOnScroll:!0}),this.droparound.show(),this.unseenBadge.addClass("hidden"),this.shouldFetchNotifs=!1},formatCount99:function(t){return t>=100?"99+":t},destructor:function(){clearInterval(this.pollIntervalId),clearTimeout(this.pollingFailedTimeoutId)}})},"@VERSION@",{requires:["flickr-view","hermes-template-notifications-menu","fluid-droparound-view","notifications-view"],langBundles:["notifications","common"]});YUI.add("hermes-template-person-card",function(a,n){var l=a.Template.Handlebars.revive({1:function(a,n,l,e,t){var s;return"\t\t\t\t\t"+a.escapeExpression(a.lambda(null!=(s=null!=n?n.person:n)?s.realname:s,n))+"\n\t\t\t\t\t"+(null!=(s=l.if.call(null!=n?n:{},null!=n?n.personLocation:n,{name:"if",hash:{},fn:a.program(2,t,0),inverse:a.noop,data:t}))?s:"")+"\n"},2:function(a,n,l,e,t){return" - "},4:function(a,n,l,e,t){var s;return null!=(s=l.each.call(null!=n?n:{},null!=n?n.photostream:n,{name:"each",hash:{},fn:a.program(5,t,0),inverse:a.noop,data:t}))?s:""},5:function(a,n,l,e,t){var s;return null!=(s=l.if.call(null!=n?n:{},null!=n?n.needsInterstitial:n,{name:"if",hash:{},fn:a.program(6,t,0),inverse:a.program(8,t,0),data:t}))?s:""},6:function(a,n,l,e,t){var s,r,i=null!=n?n:{},o=l.helperMissing,u=a.escapeExpression,c=a.lambda;return'\t\t\t\t\t<a href="'+u("function"==typeof(r=null!=(r=l.url||(null!=n?n.url:n))?r:o)?r.call(i,{name:"url",hash:{},data:t}):r)+'" title="'+u("function"==typeof(r=null!=(r=l.title||(null!=n?n.title:n))?r:o)?r.call(i,{name:"title",hash:{},data:t}):r)+'" width="'+u(c(null!=(s=null!=(s=null!=n?n.sizes:n)?s.sq:s)?s.width:s,n))+'" height="'+u(c(null!=(s=null!=(s=null!=n?n.sizes:n)?s.sq:s)?s.height:s,n))+'" style="background: url(https://s.yimg.com/pw/images/spaceball.gif);" data-track="personCardRecentPhotosClick"></a>\n'},8:function(a,n,l,e,t){var s,r,i=null!=n?n:{},o=l.helperMissing,u=a.escapeExpression;return'\t\t\t\t\t<a href="'+u("function"==typeof(r=null!=(r=l.url||(null!=n?n.url:n))?r:o)?r.call(i,{name:"url",hash:{},data:t}):r)+'" title="'+u("function"==typeof(r=null!=(r=l.title||(null!=n?n.title:n))?r:o)?r.call(i,{name:"title",hash:{},data:t}):r)+'" style="background: url('+u(a.lambda(null!=(s=null!=(s=null!=n?n.sizes:n)?s.sq:s)?s.displayUrl:s,n))+');" data-track="personCardRecentPhotosClick"></a>\n'},10:function(a,n,l,e,t){return'\t\t\t<span class="tertiary">'+a.escapeExpression((l.intlMessage||n&&n.intlMessage||l.helperMissing).call(null!=n?n:{},{name:"intlMessage",hash:{intlName:"person.NO_PHOTOS"},data:t}))+"</span>\n"},compiler:[7,">= 4.0.0"],main:function(a,n,l,e,t){var s,r,i=null!=n?n:{},o=l.helperMissing,u=a.escapeExpression,c=a.lambda;return'\n<div>\n\t<section>\n\t\t<div class="follow-subview">'+u((l.outlet||n&&n.outlet||o).call(i,null!=n?n["follow-view"]:n,{name:"outlet",hash:{},data:t}))+'</div>\n\n\t\t<div class="attribution">\n\t\t\t<a href="'+u(c(null!=(s=null!=n?n.personURLS:n)?s.photostream:s,n))+'" data-track="personCardAttributionNameClick">\n\t\t\t\t<h3 class="fade-out">'+u(c(null!=(s=null!=n?n.person:n)?s.username:s,n))+'</h3>\n\t\t\t</a>\n\t\t</div>\n\t\t<div class="info">\n\t\t\t<span class="secondary realname fade-out">\n'+(null!=(s=l.if.call(i,null!=(s=null!=n?n.person:n)?s.realname:s,{name:"if",hash:{},fn:a.program(1,t,0),inverse:a.noop,data:t}))?s:"")+"\t\t\t\t"+u("function"==typeof(r=null!=(r=l.personLocation||(null!=n?n.personLocation:n))?r:o)?r.call(i,{name:"personLocation",hash:{},data:t}):r)+'\n\t\t\t</span>\n\t\t</div>\n\n\t\t<div class="recent-photos">\n'+(null!=(s=l.if.call(i,null!=n?n.photostream:n,{name:"if",hash:{},fn:a.program(4,t,0),inverse:a.program(10,t,0),data:t}))?s:"")+'\t\t</div>\n\t</section>\n</div>\n\n<div class="links secondary">\n\t<a href="'+u(c(null!=(s=null!=n?n.personURLS:n)?s.sendFlickrMail:s,n))+'" data-track="personCardMessageClick">'+u((l.intlMessage||n&&n.intlMessage||o).call(i,{name:"intlMessage",hash:{intlName:"person.MESSAGE"},data:t}))+'</a>\n\t<a href="'+u(c(null!=(s=null!=n?n.personURLS:n)?s.albums:s,n))+'" data-track="personCardAlbumsClick">'+u((l.intlMessage||n&&n.intlMessage||o).call(i,{name:"intlMessage",hash:{intlName:"person.ALBUMS"},data:t}))+'</a>\n\t<a href="'+u(c(null!=(s=null!=n?n.personURLS:n)?s.favorites:s,n))+'" data-track="personCardFavesClick">'+u((l.intlMessage||n&&n.intlMessage||o).call(i,{name:"intlMessage",hash:{intlName:"person.FAVES"},data:t}))+'</a>\n\t<a class="align-right" href="'+u(c(null!=(s=null!=n?n.personURLS:n)?s.profile:s,n))+'" data-track="personCardProfileClick">'+u((l.intlMessage||n&&n.intlMessage||o).call(i,{name:"intlMessage",hash:{intlName:"common.ABOUT"},data:t}))+"</a>\n</div>\n"},useData:!0}),e={};a.Array.each([],function(n){var l=a.Template.get("hermes/"+n);l&&(e[n]=l)}),a.Template.register("hermes/person-card",function(n,t){return t=t||{},t.partials=t.partials?a.merge(e,t.partials):e,l(n,t)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("person-card-view",function(e){e.namespace("Views")[this.name]=e.Base.create("person-card-view",e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.nsid=e.nsid,this.pathAlias=e.pathAlias,this.set("isActiveViewAgnostic",e.isActiveViewAgnostic||!1),""===this.get("container").get("innerHTML")&&this.setContainerHTML(""),this},subviewConfig:{"follow-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1}},loadState:function(){var t=this,s={contentType:7};return this.nsid?s.id=this.nsid:s.pathAlias=this.pathAlias,new e.FlickrPromise({person:this.appContext.getModel("person-models",s),photostream:this.appContext.getModel("photostream-models",s),personProfile:this.appContext.getModel("person-profile-models",s)}).then(function(e){return t.personModel=e.person,t.personLocation=e.personProfile.getValue("location"),e.photostream.getValue("photoPageList").getPage({page:1,perPage:5}).then(function(e){t.photostreamPhotos=e})},function(e){t.loadingError=!0,1===e.code&&"User not found"===e.message&&(t.badUser=!0)})},buildContainer:function(){var t,s;return this.loadingError?(s=this.badUser?'<span class="no-user">'+this.intlMessage({intlName:"person.NO_LONGER_ON_FLICKR"})+"</span>":'<span class="error-user">'+this.intlMessage({intlName:"person.ERROR_LOADING"})+"</span>",this.setContainerHTML(s)):(t=this.personModel.toJSON(),this.setContainerWithTemplate("person-card",{person:t,photostream:this.photostreamPhotos.map(function(e){return e.toJSON()}),personLocation:this.personLocation,personURLS:e.URLHelper.generatePersonUrls(this.personModel)})),this},activate:function(){var e=this.get("container"),t=e.one(".follow-view"),s=t.one(".relationship"),o=t.one(".relationship > .is-following"),n=e.one(".attribution");return s?o&&n.addClass("shorter"):n.addClass("full"),this}})},"@VERSION@",{requires:["flickr-view","flickr-promise","hermes-template-person-card","url-helper"],langBundles:["person","common"]});YUI.add("hermes-lang-person",function(o,e){o.Intl.add("hermes/person","en-US",{MESSAGE:["Message"],ALBUMS:["Albums"],FAVES:["Faves"],PROFILE:["Profile"],NO_PHOTOS:["This user has no photos visible to you."],NO_LONGER_ON_FLICKR:["This user is not found, or no longer on Flickr."],ERROR_LOADING:["Error loading user card. Please try again."],RELATIONSHIP_FRIEND_ERROR:["There was a problem setting your friend relationship."],RELATIONSHIP_FAMILY_ERROR:["There was a problem setting your family relationship."],SIGN_IN_BEFORE_FOLLOW_TITLE:["You found someone to follow!"],SIGN_IN_BEFORE_FOLLOW_MESSAGE:["That's awesome. Just sign in to follow them."],JOIN_FLICKR_AND_FOLLOW:["Join Flickr to never miss a post from ","${person}","."],SIGN_IN_AND_FOLLOW:["Sign in and follow"],CURATOR_PASS_OVER:["Pass over"],CURATOR_PASS_OVER_UNDO:["Undo pass over"]})},"@VERSION@",{requires:["intl"]});YUI.add("person-menu-view",function(e){var t=require("hermes-core/type-validator");e.namespace("Views")[this.name]=e.Base.create("person-menu-view",e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.containerSelector=e.containerSelector,this.excludeSelectors=[".no-menu"].concat(e.excludeSelectors||[]),this.personSelector=".avatar.person, .photo-attribution .attribution-icon, .comment-icon.circle-icon a, .show-person-menu",this.dialogCache=[],this.currentDialog,this},loadState:function(){return e.Promise.resolve()},buildContainer:function(){return this.setContainerHTML(""),this},toJSON:function(){return e.merge(this.get("user"))},activate:function(){this.registerEventHandler(e.one(this.containerSelector).delegate("click",this.onClickTarget.bind(this),this.personSelector,this))},onClickTarget:function(t){var n;this.shouldProcessTarget(t.target)&&(t.preventDefault(),t.halt(),n=t.target.ancestor().one(this.personSelector)||t.target.ancestor(this.personSelector)||t.target.ancestor("a"),this.createParamsAndManageState(n),e.rapidTracker.beacon(this.name,"personCardOpened"))},shouldProcessTarget:function(e){return null!==e.ancestor()&&!this.excludeSelectors.some(function(t){return e.ancestor().one(t)||e.ancestor(t)})},createParamsAndManageState:function(e){var t=this.getParams(e);this.createDialog(t,e)},getParams:function(e){var n,i={appContext:this.appContext,isActiveViewAgnostic:!0},r="";return(r=e.getData("person-nsid")||e.ancestor().getData("person-nsid"))||(0===(n=e.getAttribute("href")||e.ancestor().getAttribute("href")).indexOf("/photos")?r=n.replace("/photos/","").replace("/",""):0===n.indexOf("/groups/")&&(r=n.slice(n.lastIndexOf("/")+1))),i.disableRefreshOnRelationshipChange=e.hasClass("no-refresh"),t.nsid(r)?i.nsid=r:i.pathAlias=r,i.signature=r,i},createDialog:function(t,n){var i,r=this;this.fire("open"),e.fire("personMenuOpen"),this.dialogCache.some(function(e){return e.key===t.signature&&(i=e.dialog,!0)}),i?i.set("anchorElement",n.ancestor().hasClass("comment-icon")?n.ancestor():n):((i=new e.Views.FluidDroparound({appContext:this.appContext,dismissOnOverlayClick:!0,showDropArrow:!0,width:350,height:165,anchorOffsetHorizontal:0,observePageResize:!0,anchorElement:n.ancestor().hasClass("comment-icon")?n.ancestor():n,subview:new e.Views["person-card-view"](t)})).on("clickOverlay",function(e){r.nextElClicked=[e.clientX,e.clientY]}),i.on("closeDroparound",function(){setTimeout(function(){if(r.nextElClicked){var t,n=document.elementFromPoint(r.nextElClicked[0],r.nextElClicked[1]);n&&(t=e.one(n))&&r.personSelector.split(",").some(function(e){return t.hasClass(e.replace(".",""))})&&r.shouldProcessTarget(t)&&r.createParamsAndManageState(t),r.nextElClicked=null}},10)}),this.dialogCache.length>10&&this.dialogCache.shift(),this.dialogCache.push({key:t.signature,dialog:i})),this.currentDialog=i,i.show()},closeDialog:function(){this.currentDialog&&(this.currentDialog.close(),e.fire("personMenuClose"))},destructor:function(){var t=this;this.currentDialog=null,e.Object.each(this.dialogCache,function(e){t.dialogCache[e]&&(t.dialogCache[e].destroy(),t.dialogCache[e]=null)}),this.dialogCache=[]}})},"@VERSION@",{requires:["flickr-promise","flickr-view","fluid-droparound-view","person-card-view"],langBundles:["person","common"]});YUI.add("hermes-template-group-card",function(a,n){var l=a.Template.Handlebars.revive({1:function(a,n,l,e,t){var s;return null!=(s=l.each.call(null!=n?n:{},null!=n?n.groupPool:n,{name:"each",hash:{},fn:a.program(2,t,0),inverse:a.noop,data:t}))?s:""},2:function(a,n,l,e,t){var s,r,i=null!=n?n:{},u=l.helperMissing,o=a.escapeExpression,p=a.lambda;return'\t\t\t\t\n\t\t\t\t<a href="'+o("function"==typeof(r=null!=(r=l.url||(null!=n?n.url:n))?r:u)?r.call(i,{name:"url",hash:{},data:t}):r)+'" title="'+o("function"==typeof(r=null!=(r=l.title||(null!=n?n.title:n))?r:u)?r.call(i,{name:"title",hash:{},data:t}):r)+'" width="'+o(p(null!=(s=null!=(s=null!=n?n.sizes:n)?s.sq:s)?s.width:s,n))+'" height="'+o(p(null!=(s=null!=(s=null!=n?n.sizes:n)?s.sq:s)?s.height:s,n))+'"\n'+(null!=(s=l.if.call(i,null!=n?n.needsInterstitial:n,{name:"if",hash:{},fn:a.program(3,t,0),inverse:a.program(5,t,0),data:t}))?s:"")+"\t\t\t\t></a>\n\t\t\t\t\n"},3:function(a,n,l,e,t){return'\t\t\t\t\tclass="restricted"\n'},5:function(a,n,l,e,t){var s;return'\t\t\t\t\tstyle="background: url('+a.escapeExpression(a.lambda(null!=(s=null!=(s=null!=n?n.sizes:n)?s.sq:s)?s.displayUrl:s,n))+');"\n'},7:function(a,n,l,e,t){var s;return null!=(s=l.if.call(null!=n?n:{},null!=n?n.canAddPhotos:n,{name:"if",hash:{},fn:a.program(8,t,0),inverse:a.program(10,t,0),data:t}))?s:""},8:function(a,n,l,e,t){var s,r=null!=n?n:{},i=l.helperMissing,u=a.escapeExpression;return'\t\t\t\t<p class="tertiary">'+u((l.intlMessage||n&&n.intlMessage||i).call(r,{name:"intlMessage",hash:{intlName:"groups.BE_THE_FIRST"},data:t}))+'</p>\n\t\t\t\t<p class="tertiary"><a href="'+u(a.lambda(null!=(s=null!=n?n.groupURLS:n)?s.photos:s,n))+'">'+u((l.intlMessage||n&&n.intlMessage||i).call(r,{name:"intlMessage",hash:{intlName:"groups.ADD_SOME_PHOTOS"},data:t}))+"</a></p>\n"},10:function(a,n,l,e,t){return"\t\t\t\t<p>"+a.escapeExpression((l.intlMessage||n&&n.intlMessage||l.helperMissing).call(null!=n?n:{},{name:"intlMessage",hash:{intlName:"groups.NO_PHOTOS"},data:t}))+"</p>\n"},12:function(a,n,l,e,t){var s,r=a.escapeExpression;return'\t<a href="'+r(a.lambda(null!=(s=null!=n?n.groupURLS:n)?s.admin:s,n))+'">'+r((l.intlMessage||n&&n.intlMessage||l.helperMissing).call(null!=n?n:{},{name:"intlMessage",hash:{intlName:"groups.ADMIN_LINK_LABEL"},data:t}))+"</a>\n"},14:function(a,n,l,e,t){var s;return null!=(s=l.if.call(null!=n?n:{},null!=(s=null!=n?n.group:n)?s.isModerator:s,{name:"if",hash:{},fn:a.program(15,t,0),inverse:a.noop,data:t}))?s:""},15:function(a,n,l,e,t){var s,r=a.escapeExpression;return'\t\t<a href="'+r(a.lambda(null!=(s=null!=n?n.groupURLS:n)?s.admin:s,n))+'">'+r((l.intlMessage||n&&n.intlMessage||l.helperMissing).call(null!=n?n:{},{name:"intlMessage",hash:{intlName:"groups.ADMIN_LINK_LABEL"},data:t}))+"</a>\n"},compiler:[7,">= 4.0.0"],main:function(a,n,l,e,t){var s,r=null!=n?n:{},i=l.helperMissing,u=a.escapeExpression,o=a.lambda;return'\n<div>\n\t<section>\n\t\t<div class="join-subview">\n\n\t\t\t'+u((l.outlet||n&&n.outlet||i).call(r,null!=n?n["join-group-view"]:n,{name:"outlet",hash:{},data:t}))+'\n\n\t\t</div>\n\n\t\t<div class="attribution">\n\t\t\t<a href="'+u(o(null!=(s=null!=n?n.groupURLS:n)?s.about:s,n))+'">\n\t\t\t\t<h3 class="fade-out">'+u((l.renderTrustedMarkup||n&&n.renderTrustedMarkup||i).call(r,null!=(s=null!=n?n.group:n)?s.title:s,{name:"renderTrustedMarkup",hash:{},data:t}))+'</h3>\n\t\t\t</a>\n\t\t</div>\n\t\t<div class="stats">\n\t\t\t<span class="secondary fade-out">'+u((l.intlMessage||n&&n.intlMessage||i).call(r,{name:"intlMessage",hash:{createdYear:null!=n?n.createdYear:n,intlName:"groups.CREATED_YEAR"},data:t}))+" - "+u((l.intlMessage||n&&n.intlMessage||i).call(r,{name:"intlMessage",hash:{updatedAgo:null!=n?n.updatedAgo:n,intlName:"groups.UPDATED_TIME_AGO"},data:t}))+'</span>\n\t\t</div>\n\n\t\t<div class="recent-photos">\n'+(null!=(s=l.if.call(r,null!=n?n.groupPool:n,{name:"if",hash:{},fn:a.program(1,t,0),inverse:a.program(7,t,0),data:t}))?s:"")+'\t\t</div>\n\t</section>\n</div>\n\n<div class="links secondary">\n\t<a href="'+u(o(null!=(s=null!=n?n.groupURLS:n)?s.photos:s,n))+'">'+u((l.intlMessage||n&&n.intlMessage||i).call(r,{name:"intlMessage",hash:{intlName:"groups.PHOTOS_LINK_LABEL"},data:t}))+'</a>\n\t<a href="'+u(o(null!=(s=null!=n?n.groupURLS:n)?s.discussions:s,n))+'">'+u((l.intlMessage||n&&n.intlMessage||i).call(r,{name:"intlMessage",hash:{intlName:"groups.DISCUSSIONS_LINK_LABEL"},data:t}))+"</a>\n"+(null!=(s=l.if.call(r,null!=(s=null!=n?n.group:n)?s.isAdmin:s,{name:"if",hash:{},fn:a.program(12,t,0),inverse:a.program(14,t,0),data:t}))?s:"")+"</div>"},useData:!0}),e={};a.Array.each([],function(n){var l=a.Template.get("hermes/"+n);l&&(e[n]=l)}),a.Template.register("hermes/group-card",function(n,t){return t=t||{},t.partials=t.partials?a.merge(e,t.partials):e,l(n,t)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("group-card-view",function(e){e.namespace("Views")[this.name]=e.Base.create("group-card-view",e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.groupId=e.groupId,this.groupPathAlias=e.groupPathAlias,this.set("isActiveViewAgnostic",e.isActiveViewAgnostic||!1),""===this.get("container").get("innerHTML")&&this.setContainerHTML(""),this},subviewConfig:{"join-group-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!1,shortLabels:!0,theme:"light"}},loadState:function(){var t=this,r=this.groupId;return new e.FlickrPromise({groupPool:this.appContext.getModel("group-pool-models",r),group:this.appContext.getModel("group-models",r),groupInfo:this.appContext.getModel("group-info-models",r)}).then(function(e){return t.groupModel=e.group,t.groupInfo=e.groupInfo,e.groupPool.getValue("photoPageList").getPage({page:1,perPage:5}).then(function(e){t.groupPhotos=e})},function(e){t.loadingError=!0})},buildContainer:function(){var t,r,o=!1;return this.loadingError?this.setContainerHTML('<span class="error-group">'+this.intlMessage({intlName:"groups.ERROR_LOADING"})+"</span>"):(t=this.groupModel.toJSON(),(o="disabled"!==(r=this.groupInfo.getValue("throttle")).mode&&r.remaining>0||"none"===r.mode)&&(o=t.isMember),this.setContainerWithTemplate("group-card",{group:t,groupPool:this.groupPhotos.map(function(e){return e.toJSON()}),canAddPhotos:o,groupURLS:e.URLHelper.generateGroupUrls(this.groupModel),createdYear:t.dateCreated.year(),updatedAgo:this.intlMessage(e.Handlebars.helpers._friendlySinceDate(t.latestGroupActivity,!0,!0))})),this},activate:function(){return this.registerEventHandler(this.get("container").delegate("click",function(e){e.preventDefault()},".join")),this}})},"@VERSION@",{requires:["flickr-view","flickr-promise","hermes-template-group-card","url-helper","handlebars-helpers"],langBundles:["groups","relative-dates"]});YUI.add("group-menu-view",function(e){"use strict";e.namespace("Views")[this.name]=e.Base.create("group-menu-view",e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.containerSelector=e.containerSelector,this.excludeSelectors=[".large",".no-menu"].concat(e.excludeSelectors||[]),this.groupSelector=".avatar.group",this.dialogCache=[],this.currentDialog,this},loadState:function(){return e.Promise.resolve()},buildContainer:function(){return this.setContainerHTML(""),this},activate:function(){this.registerEventHandler(e.one(this.containerSelector).delegate("click",this.onClickTarget.bind(this),this.groupSelector,this))},onClickTarget:function(e){var t;this.shouldProcessTarget(e.target)&&(e.preventDefault(),e.halt(),t=e.target,this.createParamsAndManageState(t))},shouldProcessTarget:function(e){return null!==e.ancestor()&&!this.excludeSelectors.some(function(t){return e.ancestor().one(t)||e.ancestor(t)})},createParamsAndManageState:function(e){var t=this.getParams(e);this.createDialog(t,e)},getParams:function(e){var t={appContext:this.appContext,isActiveViewAgnostic:!0};return t.groupId=e.getData("group-nsid"),t.signature=t.groupId,t},createDialog:function(t,i){var n,a=this;this.fire("open"),this.dialogCache.some(function(e){return e.key===t.signature&&(n=e.dialog,!0)}),n?n.set("anchorElement",i):((n=new e.Views.FluidDroparound({appContext:this.appContext,dismissOnOverlayClick:!0,showDropArrow:!0,width:350,height:165,observePageResize:!0,anchorElement:i,anchorOffsetHorizontal:4,subview:new e.Views["group-card-view"](t)})).on("clickOverlay",function(e){a.nextElClicked=[e.clientX,e.clientY]}),n.on("closeDroparound",function(){setTimeout(function(){if(a.nextElClicked){var t,i,n=document.elementFromPoint(a.nextElClicked[0],a.nextElClicked[1]);n&&(t=e.one(n),i=a.groupSelector.split(",").some(function(e){return t.hasClass(e.replace(".",""))}),t&&i&&a.shouldProcessTarget(t)&&a.createParamsAndManageState(t)),a.nextElClicked=null}},10)}),this.dialogCache.length>10&&this.dialogCache.shift(),this.dialogCache.push({key:t.signature,dialog:n})),this.currentDialog=n,n.show()},closeDialog:function(){this.currentDialog&&this.currentDialog.close()},destructor:function(){var t=this;this.currentDialog=null,e.Object.each(this.dialogCache,function(e){t.dialogCache[e]&&(t.dialogCache[e].destroy(),t.dialogCache[e]=null)}),this.dialogCache=null}})},"@VERSION@",{requires:["flickr-promise","flickr-view","fluid-droparound-view","group-card-view"],langBundles:["common"]});YUI.add("hermes-template-fluid-modal",function(n,l){var t=n.Template.Handlebars.revive({1:function(n,l,t,a,e){return" html-modal"},3:function(n,l,t,a,e){return" subview-modal"},5:function(n,l,t,a,e){return'<div class="close-x" aria-label="'+n.escapeExpression((t.intlMessage||l&&l.intlMessage||t.helperMissing).call(null!=l?l:{},{name:"intlMessage",hash:{intlName:"common.CLOSE"},data:e}))+'" tabindex="0"></div>'},7:function(n,l,t,a,e){var i;return'\t\t<div class="head">\n'+(null!=(i=t.if.call(null!=l?l:{},null!=l?l.navBarView:l,{name:"if",hash:{},fn:n.program(8,e,0),inverse:n.program(10,e,0),data:e}))?i:"")+'\t\t\t<div class="extra"></div>\n\t\t</div>\n'},8:function(n,l,t,a,e){return'\t\t\t\t<div class="nav"></div>\n'},10:function(n,l,t,a,e){var i;return'\t\t\t\t<div class="title">\n'+(null!=(i=t.if.call(null!=l?l:{},null!=l?l.title:l,{name:"if",hash:{},fn:n.program(11,e,0),inverse:n.program(13,e,0),data:e}))?i:"")+"\t\t\t\t</div>\n"},11:function(n,l,t,a,e){var i;return"\t\t\t\t\t\t"+n.escapeExpression("function"==typeof(i=null!=(i=t.title||(null!=l?l.title:l))?i:t.helperMissing)?i.call(null!=l?l:{},{name:"title",hash:{},data:e}):i)+"\n"},13:function(n,l,t,a,e){return"\t\t\t\t\t\t"+n.escapeExpression((t.renderTrustedMarkup||l&&l.renderTrustedMarkup||t.helperMissing).call(null!=l?l:{},null!=l?l.htmlTitle:l,{name:"renderTrustedMarkup",hash:{},data:e}))+"\n"},15:function(n,l,t,a,e){return" lines"},17:function(n,l,t,a,e){var i,r,s=null!=l?l:{},o=t.helperMissing;return'\t\t\t<div\n\t\t\t\tclass="content text-only '+(null!=(i=t.if.call(s,null!=l?l.noScroll:l,{name:"if",hash:{},fn:n.program(18,e,0),inverse:n.noop,data:e}))?i:"")+(null!=(i=t.if.call(s,null!=l?l.showFooter:l,{name:"if",hash:{},fn:n.program(20,e,0),inverse:n.noop,data:e}))?i:"")+'"\n\t\t\t\tstyle="'+(null!=(i=(t.ifDefined||l&&l.ifDefined||o).call(s,null!=l?l.contentPadding:l,{name:"ifDefined",hash:{},fn:n.program(22,e,0),inverse:n.noop,data:e}))?i:"")+'">\n\t\t\t\t'+n.escapeExpression("function"==typeof(r=null!=(r=t.textMessage||(null!=l?l.textMessage:l))?r:o)?r.call(s,{name:"textMessage",hash:{},data:e}):r)+"\n\t\t\t</div>\n"},18:function(n,l,t,a,e){return" no-scroll"},20:function(n,l,t,a,e){return" has-footer"},22:function(n,l,t,a,e){var i,r,s=null!=l?l:{},o=t.helperMissing,u=n.escapeExpression;return"\n\t\t\t\t\tpadding-right: "+u("function"==typeof(r=null!=(r=t.contentPadding||(null!=l?l.contentPadding:l))?r:o)?r.call(s,{name:"contentPadding",hash:{},data:e}):r)+"px;\n\t\t\t\t\t"+(null!=(i=t.if.call(s,null!=l?l.showFooter:l,{name:"if",hash:{},fn:n.noop,inverse:n.program(23,e,0),data:e}))?i:"")+"\n\t\t\t\t\tpadding-left: "+u("function"==typeof(r=null!=(r=t.contentPadding||(null!=l?l.contentPadding:l))?r:o)?r.call(s,{name:"contentPadding",hash:{},data:e}):r)+"px;\n\t\t\t\t"},23:function(n,l,t,a,e){var i;return"padding-bottom: "+n.escapeExpression("function"==typeof(i=null!=(i=t.contentPadding||(null!=l?l.contentPadding:l))?i:t.helperMissing)?i.call(null!=l?l:{},{name:"contentPadding",hash:{},data:e}):i)+"px;"},25:function(n,l,t,a,e){var i,r=null!=l?l:{},s=t.helperMissing;return'\t\t\t<div\n\t\t\t\tclass="content html-only '+(null!=(i=t.if.call(r,null!=l?l.noScroll:l,{name:"if",hash:{},fn:n.program(18,e,0),inverse:n.noop,data:e}))?i:"")+(null!=(i=t.if.call(r,null!=l?l.showFooter:l,{name:"if",hash:{},fn:n.program(20,e,0),inverse:n.noop,data:e}))?i:"")+'"\n\t\t\t\tstyle="'+(null!=(i=(t.ifDefined||l&&l.ifDefined||s).call(r,null!=l?l.contentPadding:l,{name:"ifDefined",hash:{},fn:n.program(22,e,0),inverse:n.noop,data:e}))?i:"")+'">\n\t\t\t\t'+n.escapeExpression((t.renderTrustedMarkup||l&&l.renderTrustedMarkup||s).call(r,null!=l?l.htmlMessage:l,{name:"renderTrustedMarkup",hash:{},data:e}))+"\n\t\t\t</div>\n"},27:function(n,l,t,a,e){var i,r=null!=l?l:{};return'\t\t\t<div\n\t\t\t\tclass="content subview '+(null!=(i=t.if.call(r,null!=l?l.noScroll:l,{name:"if",hash:{},fn:n.program(18,e,0),inverse:n.noop,data:e}))?i:"")+(null!=(i=t.if.call(r,null!=l?l.showFooter:l,{name:"if",hash:{},fn:n.program(20,e,0),inverse:n.noop,data:e}))?i:"")+'"\n\t\t\t\tstyle="'+(null!=(i=(t.ifDefined||l&&l.ifDefined||t.helperMissing).call(r,null!=l?l.contentPadding:l,{name:"ifDefined",hash:{},fn:n.program(22,e,0),inverse:n.noop,data:e}))?i:"")+'"></div>\n'},29:function(n,l,t,a,e){var i;return'\t\t<div class="foot">\n'+(null!=(i=t.if.call(null!=l?l:{},null!=(i=null!=l?l.buttons:l)?i.visible:i,{name:"if",hash:{},fn:n.program(30,e,0),inverse:n.noop,data:e}))?i:"")+"\t\t</div>\n"},30:function(n,l,t,a,e){var i,r=null!=l?l:{};return'\t\t\t<div class="buttons">\n\t\t\t\t'+(null!=(i=t.if.call(r,null!=(i=null!=(i=null!=l?l.buttons:l)?i.action:i)?i.visible:i,{name:"if",hash:{},fn:n.program(31,e,0),inverse:n.noop,data:e}))?i:"")+"\n\t\t\t\t"+(null!=(i=t.if.call(r,null!=(i=null!=(i=null!=l?l.buttons:l)?i.cancel:i)?i.visible:i,{name:"if",hash:{},fn:n.program(36,e,0),inverse:n.noop,data:e}))?i:"")+"\n"+(null!=(i=t.if.call(r,null!=(i=null!=l?l.buttons:l)?i.flavorText:i,{name:"if",hash:{},fn:n.program(38,e,0),inverse:n.noop,data:e}))?i:"")+"\t\t\t</div>\n"},31:function(n,l,t,a,e){var i,r=null!=l?l:{};return'<button class="mini '+(null!=(i=t.if.call(r,null!=(i=null!=(i=null!=l?l.buttons:l)?i.action:i)?i.isDangerous:i,{name:"if",hash:{},fn:n.program(32,e,0),inverse:n.noop,data:e}))?i:"")+' action"'+(null!=(i=t.if.call(r,null!=(i=null!=(i=null!=l?l.buttons:l)?i.action:i)?i.disabled:i,{name:"if",hash:{},fn:n.program(34,e,0),inverse:n.noop,data:e}))?i:"")+">"+n.escapeExpression(n.lambda(null!=(i=null!=(i=null!=l?l.buttons:l)?i.action:i)?i.label:i,l))+"</button>"},32:function(n,l,t,a,e){return"danger"},34:function(n,l,t,a,e){return' disabled="disabled"'},36:function(n,l,t,a,e){var i;return'<button class="mini alt cancel">'+n.escapeExpression(n.lambda(null!=(i=null!=(i=null!=l?l.buttons:l)?i.cancel:i)?i.label:i,l))+"</button>"},38:function(n,l,t,a,e){var i,r=null!=l?l:{};return'\t\t\t\t<div class="flavor-text secondary'+(null!=(i=t.unless.call(r,null!=(i=null!=(i=null!=l?l.buttons:l)?i.flavorText:i)?i.visible:i,{name:"unless",hash:{},fn:n.program(39,e,0),inverse:n.noop,data:e}))?i:"")+'">'+n.escapeExpression((t.renderTrustedMarkup||l&&l.renderTrustedMarkup||t.helperMissing).call(r,null!=(i=null!=(i=null!=l?l.buttons:l)?i.flavorText:i)?i.text:i,{name:"renderTrustedMarkup",hash:{},data:e}))+"</div>\n"},39:function(n,l,t,a,e){return" hidden"},compiler:[7,">= 4.0.0"],main:function(n,l,t,a,e){var i,r,s=null!=l?l:{};return'<div class="modal'+(null!=(i=t.if.call(s,null!=l?l.htmlMessage:l,{name:"if",hash:{},fn:n.program(1,e,0),inverse:n.noop,data:e}))?i:"")+(null!=(i=t.if.call(s,null!=l?l.subview:l,{name:"if",hash:{},fn:n.program(3,e,0),inverse:n.noop,data:e}))?i:"")+" "+n.escapeExpression("function"==typeof(r=null!=(r=t.classList||(null!=l?l.classList:l))?r:t.helperMissing)?r.call(s,{name:"classList",hash:{},data:e}):r)+'">\n\t'+(null!=(i=t.if.call(s,null!=l?l.showCancelX:l,{name:"if",hash:{},fn:n.program(5,e,0),inverse:n.noop,data:e}))?i:"")+"\n"+(null!=(i=t.if.call(s,null!=l?l.showHeader:l,{name:"if",hash:{},fn:n.program(7,e,0),inverse:n.noop,data:e}))?i:"")+'\t<div class="body'+(null!=(i=t.if.call(s,null!=l?l.showBodyLines:l,{name:"if",hash:{},fn:n.program(15,e,0),inverse:n.noop,data:e}))?i:"")+'">\n'+(null!=(i=t.if.call(s,null!=l?l.textMessage:l,{name:"if",hash:{},fn:n.program(17,e,0),inverse:n.noop,data:e}))?i:"")+(null!=(i=t.if.call(s,null!=l?l.htmlMessage:l,{name:"if",hash:{},fn:n.program(25,e,0),inverse:n.noop,data:e}))?i:"")+(null!=(i=t.if.call(s,null!=l?l.subview:l,{name:"if",hash:{},fn:n.program(27,e,0),inverse:n.noop,data:e}))?i:"")+"\t</div>\n"+(null!=(i=t.if.call(s,null!=l?l.showFooter:l,{name:"if",hash:{},fn:n.program(29,e,0),inverse:n.noop,data:e}))?i:"")+"</div>\n"},useData:!0}),a={};n.Array.each([],function(l){var t=n.Template.get("hermes/"+l);t&&(a[l]=t)}),n.Template.register("hermes/fluid-modal",function(l,e){return e=e||{},e.partials=e.partials?n.merge(a,e.partials):a,t(l,e)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("fluid-modal-view",function(e,t){"use strict";var i,n,a=require("hermes-core/flog")(t);i={css:{destinationContainer:"body",closeX:".close-x",buttonCancel:"button.cancel",buttonAction:"button.action",navBarContent:".head .nav",subviewContent:".content.subview",modalContent:".body .content"},options:{}},n={supportsTransform:!1,modal:{height:0,width:0}},e.namespace("Views").FluidModal=e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){this.set("isActiveViewAgnostic",!0);var i=this.get("modalOverlayType");return this.alreadyShowingModal=i.alreadyShowingModal(),this.alreadyShowingModal||(i.add(this),e.OverlayManager.ModalOverlay.setOverlayStyle({overlayClassList:this.get("overlayClassList")})),this},activate:function(){var t=this.get("container"),n=this;return this.get("showCancelX")&&this.registerEventHandler(t.one(i.css.closeX).on(["click","keydown"],function(e){"click"!==e.type&&13!==e.keyCode||this.handleX(e)},this)),this.get("showFooter")&&this.get("showCancelButton")&&this.get("showButtons")&&this.registerEventHandler(t.one(i.css.buttonCancel).on("click",e.bind(this.handleCancel,this))),this.get("showFooter")&&this.get("showActionButton")&&this.get("showButtons")&&this.registerEventHandler(t.one(i.css.buttonAction).on("click",e.bind(this.handleAction,this))),this.registerEventHandler(this.appContext.flapp.on("activeViewChange",function(e){n.close(e)})),this.registerEventHandler(e.globalEvents.subscribe("window:resize",function(e){n.reposition()})),this.get("navBarView")&&n.get("navBarView").activate(),this.get("subview")&&(n.get("subview").normalizedActivate(),n.registerEventHandler(n.get("subview").on("actionClick",e.bind(n.handleAction,n)))),this.registerEventHandler(t.delegate("keydown",this.keyboardSelectRadio.bind(this),"label")),this.get("focusOnFirstTabPress")&&this.registerEventHandler(t.ancestor("body").once("key",this.focusOnFirstTab.bind(this),"down:9")),e.Accessibility.manageFocusOutlines(this),this.registerEventHandler(e.on("modal:updateText",function(e){n.set("title",e.title),n.set("cancelButtonLabel",e.cancelText),n.set("actionButtonLabel",e.actionText),t.one(".title").set("textContent",e.title),t.one(".cancel").set("textContent",e.cancelText),t.one(".action").set("textContent",e.actionText)})),this.fire("activated"),this},focusOnFirstTab:function(e){var t=this.get("container").one("[tabindex]");t&&t.focus()},keyboardSelectRadio:function(e){if(13===e.keyCode){var t=this.get("container").one("#"+e.target.getAttribute("for"));t.set("checked",!t.get("checked"))}},clearOutline:function(){var t=e.one(document.activeElement);t&&t.addClass("no-outline")},restoreOutline:function(){var e=this.get("container").one(":focus");e&&e.removeClass("no-outline")},show:function(){return this.initialize().then(null,function(e){a.error("Error initializing modal",{err:e})}),this.isClosed=!1,this.freeze(),e.fire("flickr:setKeyEventScope",this.getKeyEventScope()),this},freeze:function(){e.one("body").setStyles({overflow:"hidden"})},unfreeze:function(){e.one("body").setStyles({overflow:"visible"})},enableActionButton:function(){var e=this.get("container").one("button.action");e&&e.getAttribute("disabled")&&e.removeAttribute("disabled")},disableActionButton:function(){var e=this.get("container").one("button.action");e&&e.setAttribute("disabled",!0)},showFlavorText:function(){var e=this.get("container").one(".buttons .flavor-text");e&&e.removeClass("hidden")},hideFlavorText:function(){var e=this.get("container").one(".buttons .flavor-text");e&&e.addClass("hidden")},buildContainer:function(){if(!this.alreadyShowingModal){var t,o=this,s=e.one(i.css.destinationContainer);t={showCancelX:this.get("showCancelX"),title:this.get("title"),htmlTitle:this.get("htmlTitle"),navBarView:!!this.get("navBarView"),noScroll:this.get("noScroll"),textMessage:this.get("textMessage"),htmlMessage:this.get("message")?this.get("message"):this.get("htmlMessage"),subview:!!this.get("subview"),showBodyLines:this.get("showBodyLines"),hideModalOverlay:this.get("hideModalOverlay"),darkOverlay:this.get("darkOverlay"),lightOverlay:this.get("lightOverlay"),showHeader:this.get("showHeader"),showFooter:this.get("showFooter"),buttons:{visible:this.get("showButtons"),action:{visible:this.get("showActionButton"),label:this.get("actionButtonLabel"),disabled:this.get("actionButtonDisabled"),isDangerous:this.get("actionButtonIsDangerous")},cancel:{visible:this.get("showCancelButton"),label:this.get("cancelButtonLabel")}},classList:this.get("classList"),contentPadding:this.get("contentPadding")},this.get("buttonFlavorText")&&(t.buttons.flavorText={visible:this.get("showButtonFlavorText"),text:this.get("buttonFlavorText")}),this.setContainerWithTemplate("fluid-modal",t),n.modal.width=this.get("width"),n.modal.minWidth=this.get("minWidth"),n.modal.height=this.get("height"),this.get("navBarView")&&(this.get("navBarView").appContext=o.appContext,this.get("navBarView").initialize().then(function(e){e.on("subviewViewEvent",function(e){e&&e.details&&e.details.length&&(o.get("subview")&&"navigation"===e.details[0]?o.get("subview").fire.apply(o.get("subview"),["parentViewEvent"].concat(e.details)):o.get("subview")&&"search"===e.details[0]&&o.get("subview").fire.apply(o.get("subview"),["parentViewEvent"].concat(e.details)),o.fire.apply(o,e.details))}),o.get("container").one(i.css.navBarContent).appendChild(e.get("container")),o.get("subview")||o.activate()})),this.get("subview")?(this.get("subview").appContext=o.appContext,this.get("subview").set("isActiveViewAgnostic",!0),this.get("subview").initialize().then(function(e){o.on("parentViewEvent",function(t){t&&t.details&&t.details.length&&e.fire.apply(e,["parentViewEvent"].concat(t.details))}),e.on("subviewViewEvent",function(e){e&&e.details&&e.details.length&&(o.get("navBarView")&&"backToList"===e.details[0]&&o.get("navBarView").fire.apply(o.get("navBarView"),["parentViewEvent"].concat(e.details)),o.fire.apply(o,e.details))}),o.get("container").one(i.css.subviewContent).appendChild(e.get("container")),s&&(s.append(o.get("container")),o.reposition()),o.activate()},function(e){a.error("Error initializing modal subview",{err:e})})):s&&(s.append(this.get("container")),this.reposition())}return this},reposition:function(){var t,a,o,s=this.get("container").one(this.get("modalSelector")),l=e.one(e.config.win),r=parseInt(l.get("innerWidth"),10),h=parseInt(l.get("innerHeight"),10),c=n.modal.width?parseInt(n.modal.width,10):parseInt(s.getComputedStyle("width"),10),d={},u=s.one(".body"),g=0,v=this.get("showFooter")?parseInt(s.one(".foot").getComputedStyle("height"),10):0,w=0,b=parseInt(u.getComputedStyle("borderTopWidth"),10)+parseInt(u.getComputedStyle("borderBottomWidth"),10),m={};n.modal.height&&(g=s.one(".head")?parseInt(s.one(".head").getComputedStyle("height"),10):0,w=n.modal.height,s.get("showFooter")&&(v=parseInt(s.one(".foot").getComputedStyle("height"),10)),n.modal.height+g+v+80+b>=h&&(w=h<=700?h-g-v-b:h-g-v-80-b),s.setStyles({maxHeight:"none"}),this.get("fullWindow")?m.height=w+"px":this.get("maxHeight")&&(m.maxHeight=w+"px"),s.one(i.css.modalContent).setStyles(m)),t=parseInt(s.getComputedStyle("height"),10),a=s.getDOMNode().scrollHeight,o=s.getDOMNode().scrollWidth,d={top:"50%",left:"50%",width:n.modal.width?c+"px":"",marginTop:-t/2+"px",marginLeft:-c/2+"px",minWidth:n.modal.minWidth?n.modal.minWidth+"px":""},t+40>h||a>t+1||c+40>r||o>c?(h<=700&&n.modal.height?d.maxHeight=h-10+"px":(d.maxHeight=h-40+"px",d.overflow="auto"),d.maxWidth=r-40+"px",d.marginTop=-Math.min(parseInt(d.maxHeight,10),t)/2+"px",d.marginLeft=-Math.min(parseInt(d.maxWidth,10),c)/2+"px"):(d.maxHeight="inherit",d.maxWidth="inherit",d.overflow="visible"),s.setStyles(d)},handleX:function(i){var n=this.get("subview");e.rapidTracker.beacon(t,"modalCancelClick"),n&&n.handleX&&n.handleX(),this.close(i),this.fire("cancelClick",i)},handleCancel:function(i){var n=this.get("subview");e.rapidTracker.beacon(t,"modalCancelClick"),n&&n.handleCancel&&!1===n.handleCancel()||(this.fire("cancelClick",i),this.close(i))},handleAction:function(e){var t=this.get("subview");t&&t.handleAction&&!1===t.handleAction()||(this.fire("actionClick",e),this.get("dismissOnActionClick")&&this.close(e))},close:function(t){e.fire("flickr:removeKeyEventScope",this.getKeyEventScope());var i=this.get("container");this.isClosed=!0,e.one("body").removeClass("scroll-fluid-modal"),this.get("subview")&&this.get("subview").destroy(),this.get("navBarView")&&this.get("navBarView").destroy(),i&&i.remove(!0),this.fire("close",t),this.destroy(),this.get("removeOverlayOnClose")||this.get("modalOverlayType").remove(this)},getKeyEventScope:function(){return this.name+this._yuid},destructor:function(){this.unfreeze(),this.detachAll()}},{ATTRS:{showCancelX:{value:!0},showCancelButton:{value:!0},showBodyLines:{value:!1},showActionButton:{value:!0},hideModalOverlay:{value:!1},darkOverlay:{value:!1},lightOverlay:{value:!1},actionButtonLabel:{valueFn:function(){return this.intlMessage({intlName:"common.OK"})}},actionButtonIsDangerous:{value:!1},cancelButtonLabel:{valueFn:function(){return this.intlMessage({intlName:"common.CANCEL"})}},actionButtonDisabled:{value:!1},showButtons:{value:!0},dismissOnOverlayClick:{value:!1},dismissOnActionClick:{value:!0},title:{value:""},htmlTitle:{value:""},navBarView:{value:null},message:{value:null},textMessage:{value:null},htmlMessage:{value:null},width:{value:0},minWidth:{value:0},height:{value:0},fullWindow:{value:!1},subview:{value:null},classList:{value:""},buttonFlavorText:{value:""},showButtonFlavorText:{value:!0},showHeader:{value:!0},showFooter:{value:!0},noScroll:{value:!1},maxHeight:{value:!0},modalSelector:{value:".modal"},modalOverlayType:{value:e.OverlayManager.ModalOverlay},removeOverlayOnClose:{value:!1},overlayClassList:{value:"",validator:function(t,i){return e.AttributeHelpers.validateString(t)},setter:function(t,i){return e.AttributeHelpers.coerceString(t)}},contentPadding:{value:void 0,validator:function(t,i){return e.AttributeHelpers.validateInteger(t)},setter:function(t,i){return e.AttributeHelpers.coerceInteger(t)}},focusOnFirstTabPress:{value:!0}}})},"@VERSION@",{requires:["flickr-view","hermes-template-fluid-modal","fluid-overlay-manager-view","attribute-helpers"],optionalRequires:["fluid"],langBundles:["common"]});YUI.add("hermes-template-signup-modal",function(a,e){var n=a.Template.Handlebars.revive({1:function(a,e,n,s,l){var i;return" "+a.escapeExpression("function"==typeof(i=null!=(i=n.signUpHeaderClass||(null!=e?e.signUpHeaderClass:e))?i:n.helperMissing)?i.call(null!=e?e:{},{name:"signUpHeaderClass",hash:{},data:l}):i)},3:function(a,e,n,s,l){var i;return" style=\"background-image:url('"+a.escapeExpression("function"==typeof(i=null!=(i=n.signUpHeaderImage||(null!=e?e.signUpHeaderImage:e))?i:n.helperMissing)?i.call(null!=e?e:{},{name:"signUpHeaderImage",hash:{},data:l}):i)+"')\""},compiler:[7,">= 4.0.0"],main:function(a,e,n,s,l){var i,t,r=null!=e?e:{},p=n.helperMissing,g=a.escapeExpression;return'<div class="signup-modal-body">\n\t<div class="head'+(null!=(i=n.if.call(r,null!=e?e.signUpHeaderClass:e,{name:"if",hash:{},fn:a.program(1,l,0),inverse:a.noop,data:l}))?i:"")+'"'+(null!=(i=n.if.call(r,null!=e?e.signUpHeaderImage:e,{name:"if",hash:{},fn:a.program(3,l,0),inverse:a.noop,data:l}))?i:"")+'></div>\n\t<h3 class="signup-title">'+g("function"==typeof(t=null!=(t=n.signUpTitle||(null!=e?e.signUpTitle:e))?t:p)?t.call(r,{name:"signUpTitle",hash:{},data:l}):t)+'</h3>\n\t<p class="signup-message">'+g("function"==typeof(t=null!=(t=n.signUpMessage||(null!=e?e.signUpMessage:e))?t:p)?t.call(r,{name:"signUpMessage",hash:{},data:l}):t)+'</p>\n\t<button class="large action signup-button">'+g((n.intlMessage||e&&e.intlMessage||p).call(r,{name:"intlMessage",hash:{intlName:"common.SIGN_UP_WITH_YAHOO"},data:l}))+'</button>\n</div>\n<div class="signup-modal-footer">\n\t<span>'+g((n.intlMessage||e&&e.intlMessage||p).call(r,{name:"intlMessage",hash:{intlName:"common.HAVE_YAHOO_ACCOUNT"},data:l}))+'</span>\n\t<a href="#" class="signin-link">'+g((n.intlMessage||e&&e.intlMessage||p).call(r,{name:"intlMessage",hash:{intlName:"common.SIGN_IN"},data:l}))+"</a>\n</div>\n"},useData:!0}),s={};a.Array.each([],function(e){var n=a.Template.get("hermes/"+e);n&&(s[e]=n)}),a.Template.register("hermes/signup-modal",function(e,l){return l=l||{},l.partials=l.partials?a.merge(s,l.partials):s,n(e,l)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("signup-modal-view",function(i,s){"use strict";i.namespace("Views").SignUpModal=i.FlickrView.create(this.name,i.Views.FluidModal,[],{initializer:function(i){return this.set("showFooter",!1),this.set("showHeader",!1),this.set("showButtonFlavorText",!1),this.set("showButtons",!1),this.set("showActionButton",!1),this.set("showCancelButton",!1),this.set("signUpHeaderClass",i.signUpHeaderClass),this.set("signUpHeaderImage",i.signUpHeaderImage),this.set("signUpTitle",i.signUpTitle),this.set("signUpMessage",i.signUpMessage),this.set("beaconPrefix",i.beaconPrefix),this.set("classList","signup-modal"),this},buildContainer:function(){if(!this.alreadyShowingModal){i.rapidTracker.beacon(this.name,this.get("beaconPrefix")+"ModalShow");var s={signUpHeaderClass:this.get("signUpHeaderClass"),signUpHeaderImage:this.get("signUpHeaderImage"),signUpTitle:this.get("signUpTitle"),signUpMessage:this.get("signUpMessage")};this.set("htmlMessage",this.templates("signup-modal")(s)),this.constructor.superclass.buildContainer.call(this)}return this},activate:function(){return this.get("container").one(".signup-button").on("click",this.handleAction.bind(this)),this.get("container").one(".signin-link").on("click",this.handleSignIn.bind(this)),this.constructor.superclass.activate.call(this),this},handleSignIn:function(s){i.rapidTracker.beacon(this.name,this.get("beaconPrefix")+"ModalSignInClick"),this.fire("signInClick",s),this.constructor.superclass.handleAction.call(this)},handleAction:function(s){i.rapidTracker.beacon(this.name,this.get("beaconPrefix")+"ModalSignUpClick"),this.fire("signUpClick",s),this.constructor.superclass.handleAction.call(this)},handleCancel:function(s){i.rapidTracker.beacon(this.name,this.get("beaconPrefix")+"CancelClick"),this.constructor.superclass.handleCancel.call(this)}})},"@VERSION@",{requires:["flickr-view","fluid-modal-view","hermes-template-signup-modal"],optionalRequires:["fluid"],langBundles:["common"]});YUI.add("hermes-template-signup-interstitial",function(e,a){var s=e.Template.Handlebars.revive({compiler:[7,">= 4.0.0"],main:function(e,a,s,t,i){var n=null!=a?a:{},l=s.helperMissing,r=e.escapeExpression;return'<div class="signup-interstitial-body interstitial-fade">\n\t<div class="close-x"></div>\n\t<div class="body">\n\t\t<div class="logo"></div>\n\t\t<h3 class="signup-interstitial-message">'+r((s.intlMessage||a&&a.intlMessage||l).call(n,{name:"intlMessage",hash:{intlName:"growth.MINI_SIGNUP_FOOTER_MESSAGE_EXPLORE"},data:i}))+'</h3>\n\t\t<div><a href="/signup" class="butt large action signup-button">'+r((s.intlMessage||a&&a.intlMessage||l).call(n,{name:"intlMessage",hash:{intlName:"common.SIGN_UP_WITH_YAHOO"},data:i}))+'</a></div>\n\t\t<a href="/signin" class="signin-link">'+r((s.intlMessage||a&&a.intlMessage||l).call(n,{name:"intlMessage",hash:{intlName:"common.SIGN_IN"},data:i}))+"</a>\n\t</div>\n</div>\n"},useData:!0}),t={};e.Array.each([],function(a){var s=e.Template.get("hermes/"+a);s&&(t[a]=s)}),e.Template.register("hermes/signup-interstitial",function(a,i){return i=i||{},i.partials=i.partials?e.merge(t,i.partials):t,s(a,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("signup-interstitial-view",function(t,i){"use strict";var n;n={css:{destinationContainer:"body",closeX:".close-x",buttonAction:"button.action",navBarContent:".head .nav",subviewContent:".content.subview",modalContent:".body .content",modalSelector:".modal"},options:{}},t.namespace("Views").SignUpInterstitial=t.FlickrView.create(this.name,t.Views.FluidModal,[],{langBundles:this.details.langBundles,buildContainer:function(){var i=t.one(n.css.destinationContainer);if(!this.alreadyShowingModal){var e={signUpMessage:this.get("signUpMessage")};this.setContainerWithTemplate("signup-interstitial",e),i&&(i.append(this.get("container")),this.reposition(),this.get("modalOverlayType").get("overlay").removeClass("interstitial-fade"),this.get("container").one(".signup-interstitial-body").removeClass("interstitial-fade"))}return this},activate:function(){var t=this.get("container");this.registerEventHandler(t.one(".signup-button").on("click",this.instrumentSignupClick.bind(this))),this.registerEventHandler(t.one(".signin-link").on("click",this.instrumentSigninClick.bind(this))),this.constructor.superclass.activate.call(this)},instrumentSignupClick:function(n){t.rapidTracker.beacon(i,"signupIntSignupClick")},instrumentSigninClick:function(n){t.rapidTracker.beacon(i,"signupIntSigninClick")},show:function(){t.rapidTracker.beacon(i,"signupIntShown"),this.constructor.superclass.show.call(this)},close:function(n){t.rapidTracker.beacon(i,"signupIntCancelClick"),this.constructor.superclass.close.call(this,n)}},{ATTRS:{showFooter:{value:!1},showHeader:{value:!1},showButtonFlavorText:{value:!1},showButtons:{value:!1},showActionButton:{value:!1},showCancelButton:{value:!1},modalSelector:{value:".signup-interstitial-body"},modalOverlayType:{value:t.OverlayManager.SignupInterstitialOverlay}}})},"@VERSION@",{requires:["flickr-view","fluid-modal-view","hermes-template-signup-interstitial"],optionalRequires:["fluid"],langBundles:["common","growth"]});YUI.add("hermes-lang-growth",function(e,o){e.Intl.add("hermes/growth","en-US",{MINI_SIGNUP_FOOTER_MESSAGE:["Never miss a post from ","${username}"],MINI_SIGNUP_FOOTER_MESSAGE_EXPLORE:["Join Flickr to explore world class photos"],MINI_SIGNUP_FOOTER_MESSAGE_SEARCH:["Join Flickr to see more ","${query}"," photos!"]})},"@VERSION@",{requires:["intl"]});YUI.add("signin-helper",function(e){function n(n,o){e.FlickrStorage.store(n,o)}function o(n,o){var i,t;o&&o.withPopup?(i=e.config.win.open(r(o),"_blank","height=650,resizable=1,scrollbars=1,location=yes"),t=setInterval(function(){i.closed&&(clearInterval(t),window.location.reload())},1e3)):e.config.win.location=r(o)}function r(n){(n=n||{}).closeWhenDone&&(n.postLoginUrl=e.url("/photo_grease_postlogin.gne",{protocol:!1}));var o=n.postLoginUrl||e.config.win.location.href;return(n.url||e.url("/signin/",{protocol:!1}))+"?redir="+encodeURIComponent(o)}function i(n,o){var r=(o=o||{}).postLoginUrl||e.config.win.location.href,i=o.url||e.url("/signup/",{protocol:!1});e.config.win.location=i+"?redir="+encodeURIComponent(r)}e.FlickrStorage={_storageKey:"flickrStorage",store:function(n,o){try{var r=[];e.StorageHelper.hasEntries(this._storageKey)&&(r=this.retrieve()),r.push({key:n,value:o}),e.StorageHelper.setItem(this._storageKey,JSON.stringify(r))}catch(e){}},retrieve:function(){var n={};try{n=JSON.parse(e.StorageHelper.getItem(this._storageKey))}catch(e){}return n},remove:function(){try{e.StorageHelper.remove(this._storageKey)}catch(e){}},hasEntries:function(){return e.StorageHelper.hasEntries(this._storageKey)}},e.SigninHelper={savePreLoginAction:n,addPendingFave:function(e,r){n("fave",e),o(0,r)},addPendingComment:function(e,n){o(0,n)},addPendingShare:function(e,r){n("share",e),o(0,r)},addPendingFollow:function(e,r){n("follow",e),o(0,r)},addPendingJoinGroup:function(e,r){n("joingroup",e),o(0,r)},addPendingDownload:function(e,r){n("download",e),o(0,r)},checkPendingQueue:function(n){var o,r,i=[];if(n){if(e.FlickrStorage.hasEntries()){o=e.FlickrStorage.retrieve();for(r in o)(function(e,n){var o=n.key,r=n.value;switch(o){case"fave":return(function(e,n){var o=n.id;e.getModelRegistry("photo-engagement-models").then(function(e){var n=e.proxy(o);n.registry.addAsFave(o)&&n.remoteUpdate()})})(e,r),!0;case"share":return!1}})(n,o[r])||i.push(o[r])}return e.FlickrStorage.remove(),i}},_redirectToSignin:o,_redirectToSignUp:i,_getSigninUrl:r,signUpPendingFave:function(e,o){n("fave",e),i(0,o)},signUpPendingComment:function(e,n){i(0,n)},signUpPendingFollow:function(e,o){n("follow",e),i(0,o)},signUpPendingJoinGroup:function(e,o){n("joingroup",e),i(0,o)},signUpPendingDownload:function(e,o){n("download",e),i(0,o)}}},"@VERSION@",{requires:["url","storage-helper"]});YUI.add("hermes-template-mobile-app-upsell",function(n,t){var e=n.Template.Handlebars.revive({1:function(n,t,e,a,s){return"is-android"},3:function(n,t,e,a,s){return"http://play.google.com/store/apps/details?id=com.yahoo.mobile.client.android.flickr"},5:function(n,t,e,a,s){return"http://appstore.com/flickr"},7:function(n,t,e,a,s){return"\t\t\t\t\t"+n.escapeExpression((e.intlMessage||t&&t.intlMessage||e.helperMissing).call(null!=t?t:{},{name:"intlMessage",hash:{intlName:"mobile.APP_ANDROID"},data:s}))+"\n"},9:function(n,t,e,a,s){return"\t\t\t\t\t"+n.escapeExpression((e.intlMessage||t&&t.intlMessage||e.helperMissing).call(null!=t?t:{},{name:"intlMessage",hash:{intlName:"mobile.APP_IOS"},data:s}))+"\n"},11:function(n,t,e,a,s){return"\t\t\t\t\t"+n.escapeExpression((e.intlMessage||t&&t.intlMessage||e.helperMissing).call(null!=t?t:{},{name:"intlMessage",hash:{intlName:"mobile.APP_ANDROID_FREE"},data:s}))+"\n"},13:function(n,t,e,a,s){return"\t\t\t\t\t"+n.escapeExpression((e.intlMessage||t&&t.intlMessage||e.helperMissing).call(null!=t?t:{},{name:"intlMessage",hash:{intlName:"mobile.APP_IOS_FREE"},data:s}))+"\n"},15:function(n,t,e,a,s){return"\t\t\t\t\t"+n.escapeExpression((e.intlMessage||t&&t.intlMessage||e.helperMissing).call(null!=t?t:{},{name:"intlMessage",hash:{intlName:"mobile.INSTALL"},data:s}))+"\n"},17:function(n,t,e,a,s){return"\t\t\t\t\t"+n.escapeExpression((e.intlMessage||t&&t.intlMessage||e.helperMissing).call(null!=t?t:{},{name:"intlMessage",hash:{intlName:"mobile.GET"},data:s}))+"\n"},compiler:[7,">= 4.0.0"],main:function(n,t,e,a,s){var l,i=null!=t?t:{};return'<div id="smartbanner" class="ios">\n\t\x3c!-- <button class="sb-close close-banner"></button> --\x3e\n\t<div class="sb-container">\n\t\t<span class="sb-icon">\n\t\t\t<svg class="close-banner icon icon-close"><use xlink:href="#icon-close"></use></svg>\n\t\t</span>\n\t\t<span class="sb-flickr-icon">\n\t\t\t<div class="outer-logo '+(null!=(l=e.if.call(i,null!=t?t.isAndroid:t,{name:"if",hash:{},fn:n.program(1,s,0),inverse:n.noop,data:s}))?l:"")+'">\n\t\t\t\t<div class="ball blue-ball"></div>\n\t\t\t\t<div class="ball pink-ball"></div>\n\t\t\t</div>\n\t\t</span>\n\t\t<div class="sb-info">\n\t\t\t<a class="sb-button" href="'+(null!=(l=e.if.call(i,null!=t?t.isAndroid:t,{name:"if",hash:{},fn:n.program(3,s,0),inverse:n.noop,data:s}))?l:"")+(null!=(l=e.if.call(i,null!=t?t.isIOS:t,{name:"if",hash:{},fn:n.program(5,s,0),inverse:n.noop,data:s}))?l:"")+'">\n\t\t\t\t<strong>\n'+(null!=(l=e.if.call(i,null!=t?t.isAndroid:t,{name:"if",hash:{},fn:n.program(7,s,0),inverse:n.noop,data:s}))?l:"")+(null!=(l=e.if.call(i,null!=t?t.isIOS:t,{name:"if",hash:{},fn:n.program(9,s,0),inverse:n.noop,data:s}))?l:"")+"\t\t\t\t</strong>\n\t\t\t\t<span>\n"+(null!=(l=e.if.call(i,null!=t?t.isAndroid:t,{name:"if",hash:{},fn:n.program(11,s,0),inverse:n.program(13,s,0),data:s}))?l:"")+'\t\t\t\t</span>\n\t\t\t</a>\n\t\t</div>\n\t\t<div class="sb-view get-app">\n\t\t\t<span>\n'+(null!=(l=e.if.call(i,null!=t?t.isAndroid:t,{name:"if",hash:{},fn:n.program(15,s,0),inverse:n.noop,data:s}))?l:"")+(null!=(l=e.if.call(i,null!=t?t.isIOS:t,{name:"if",hash:{},fn:n.program(17,s,0),inverse:n.noop,data:s}))?l:"")+"\t\t\t</span>\n\t\t</div>\n\t</div>\n</div>\n"},useData:!0}),a={};n.Array.each([],function(t){var e=n.Template.get("hermes/"+t);e&&(a[t]=e)}),n.Template.register("hermes/mobile-app-upsell",function(t,s){return s=s||{},s.partials=s.partials?n.merge(a,s.partials):a,e(t,s)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("mobile-app-upsell-view",function(e){e.namespace("Views")[this.name]=e.Base.create("mobile-app-upsell-view",e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.nsid=e.nsid,this.photoId=e.photoId,this.buildContainer(),this},buildContainer:function(){var e=this.appContext.getUA().os;return this.setContainerWithTemplate("mobile-app-upsell",{isAndroid:"android"===e,isIOS:"ios"===e}),this},setRootViewAdditionalViewClasses:function(){var e=[],i=this.appContext.getUA().os;return e.push(i),e.push("show-upsell-banner"),this.set("rootViewAdditionalViewClasses",e),this},activate:function(){var i=this.get("container"),t=i.one(".close-banner"),n=i.one(".get-app");return t&&this.registerEventHandler(this.addBannerEvent(t,"dism",this.dismissBanner.bind(this))),n&&this.registerEventHandler(this.addBannerEvent(n,"inst",this.installApp.bind(this))),e.rapidTracker.beacon(this.name,"app_promo_interstitial_shown",{section:"app-interstitial"}),this},addBannerEvent:function(e,i,t){var n=this;return e.on("click",function(e){e.preventDefault(),n.appContext.setCookie({cookieName:i,path:"/",cookieValue:!0,remove:!0}),n.fire("subviewViewEvent","removeUpsell"),t()})},dismissBanner:function(){if(navigator.cookieEnabled){var i=parseInt(this.appContext.getCookie("flaidisn"),10);!i||isNaN(i)?i=0:i+=1,e.rapidTracker.beacon(this.name,"app_promo_interstitial_dismissed"+(i>0?"_"+(i+1):""),{section:"app-interstitial"});var t;i<2?t=e.moment().add(3,"days").toDate():2===i?t=e.moment().add(7,"days").toDate():3===i&&(t=e.moment().add(20,"year").toDate()),this.appContext.setCookie({cookieName:"flaidisn",cookieValue:1,expires:t,remove:!0,path:"/"})}else e.rapidTracker.beacon(this.name,"cookies_off",{section:"app-interstitial"})},installApp:function(){var i=this.appContext.getUA().os,t=this.appContext.getUA().isWebview,n="photos/"+this.nsid+"/"+this.photoId,a=this;e.rapidTracker.beacon(this.name,"app_promo_interstitial_download",{section:"app-interstitial"}),this.appContext.setCookie({cookieName:"flaidis",cookieValue:1,expires:e.moment().add(20,"year").toDate(),remove:!0,path:"/"}),setTimeout(function(){e.use("mobile-actions-helper",function(e){e.MobileActionsHelper.redirectToAppOrStore({os:i,isWebview:t,pageURL:n,beacon:{name:"app_promo_banner_open",section:"appbanner"},viewName:a.name})})},250)}},{ATTRS:{}}),e.namespace("Views")[this.name].shouldShowBanner=function(e){var i=e.getCookie("dism")||e.getCookie("inst"),t=e.getUA().os;return!i&&"android"===t}},"@VERSION@",{requires:["flickr-view","flickr-promise","hermes-template-mobile-app-upsell"],langBundles:["common","mobile"]});YUI.add("hermes-lang-mobile",function(e,r){e.Intl.add("hermes/mobile","en-US",{APP_IOS:["Flickr for iOS"],APP_ANDROID:["Flickr for Android"],APP_IOS_FREE:["Free in the App Store"],APP_ANDROID_FREE:["Free in the Google Play"],GET:["Get"],INSTALL:["Install"]})},"@VERSION@",{requires:["intl"]});YUI.add("hermes-template-partner-account-banner",function(e,a){var r=e.Template.Handlebars.revive({compiler:[7,">= 4.0.0"],main:function(e,a,r,n,t){return'<div class="banner-container">\n\t<p>Dear Flickr Member: due to partnership changes with AT&T, you need to update your primary email address. <a class="learn-more">Learn more</a></p>\n</div>\n'},useData:!0}),n={};e.Array.each([],function(a){var r=e.Template.get("hermes/"+a);r&&(n[a]=r)}),e.Template.register("hermes/partner-account-banner",function(a,t){return t=t||{},t.partials=t.partials?e.merge(n,t.partials):n,r(a,t)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-partner-account-modal",function(e,t){var a=e.Template.Handlebars.revive({compiler:[7,">= 4.0.0"],main:function(e,t,a,n,r){return'<div>\n\tWith the launch of the new att.net homepage on June 30, 2017, you will need to change the primary email address you use to sign into your Flickr/Yahoo account. Your data and photos on Flickr will not be deleted or modified in any way. You will need to complete this process before June 30, 2017 in order to continue accessing your Flickr account.\n\t<br/><br/>\n\t<a href="/partner-account">Click here to learn more about these changes.</a>\n\t<br/><br/>\n\t<a href="/account/transfer">\n\t\t<button class="update-email">Update your email address</button>\n\t</a>\n</div>\n'},useData:!0}),n={};e.Array.each([],function(t){var a=e.Template.get("hermes/"+t);a&&(n[t]=a)}),e.Template.register("hermes/partner-account-modal",function(t,r){return r=r||{},r.partials=r.partials?e.merge(n,r.partials):n,a(t,r)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("partner-account-banner-view",function(e,t){e.FlickrView.create(this.name,e.FlickrView,[],{buildContainer:function(){return this.setContainerWithTemplate("partner-account-banner"),this},activate:function(){var n=this.get("container").one(".learn-more");return n&&this.registerEventHandler(n.on("click",this.openModal.bind(this))),e.AnchorRepositioner.addOffset(t,this.get("container")),this},openModal:function(){new e.Views.FluidModal({title:"The way you sign in to Flickr is changing",htmlMessage:this.templates("partner-account-modal")({}),appContext:this.appContext,dismissOnOverlayClick:!0,dismissOnActionClick:!0,showCancelX:!0,showCancelButton:!1,showActionButton:!1,hideModalOverlay:!1,showFooter:!1}).show()},destructor:function(){e.AnchorRepositioner.removeOffset(t)}})},"@VERSION@",{requires:["flickr-view","hermes-template-partner-account-banner","hermes-template-partner-account-modal"]});YUI.add("global-nav-view",function(e,t){e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){var n,i;if(void 0===t.enableBrowserUpgradeBanner&&(t.enableBrowserUpgradeBanner=!0),this.set("showBrowserUpgradeBanner",!1),YUI.Env.isServer&&t.enableBrowserUpgradeBanner){var r=this.appContext.request.headers["user-agent"],s=e.BrowserSupport.isUnsupportedBrowser(r),a=e.BrowserSupport.isBot(r),o=e.BrowserSupport.isSharingBot(r);!s||a||o||this.set("showBrowserUpgradeBanner",!0)}if(!YUI.Env.isServer){var l=e.StorageHelper.getItem("hasDismissedBrowserUpgradeBanner",!0);l&&"true"===l&&this.set("showBrowserUpgradeBanner",!1)}return""===this.get("container").get("innerHTML")&&this.setContainerHTML('<div class="global-nav-content"></div>'),this.appStateParams=t,this.themeClass=t.theme||"default-theme",n=this.appContext.getLocation(),i=t.modelParams&&t.modelParams.apiParams?t.modelParams.apiParams:n.href,this.searchUrl=new e.SearchUrl(i,this.appContext,t.searchType),this.appContext.flipper.isFlipped("enable-signed-out-cta-test")&&(this.signedOutTest=!0),this.appContext.flipper.isFlipped("enable-sign-up-interstitial-test")&&"en-us"===this.appContext.lang.toLowerCase()&&(this.signUpInterstitialTest=!0),!this.appContext.flipper.isFlipped("enable-sign-up-rail-test")||"en-us"!==this.appContext.lang.toLowerCase()||this.appContext.getViewer().signedIn||t.isSOHP||(this.signUpRailTest=!0),this.isSOHP=t.isSOHP,this.hideBanner=t.isSearchResults,this},subviewConfig:{"search-autosuggest-field-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0,isSOHP:this.isSOHP},"account-menu-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"notifications-menu-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,disabled:function(){return!this.appContext.flipper.isFlipped("notifications-menu")}},"browser-upgrade-banner-view":{requiredToShowOnServer:!0,requiredToShowOnClient:!1,dealbreaker:!1,disabled:function(){return!this.get("showBrowserUpgradeBanner")}},"person-menu-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,containerSelector:"#content",excludeSelectors:[".c-account-menu"],disabled:function(){return!(this.appContext.flipper.isFlipped("enable-hover-account-menu")&&this.appContext.flipper.isFlipped("rebootify-group-discussions-list"))}},"group-menu-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,containerSelector:"#content",excludeSelectors:[".c-account-menu"],disabled:function(){return!(this.appContext.flipper.isFlipped("enable-hover-account-menu")&&this.appContext.flipper.isFlipped("rebootify-group-discussions-list"))}},"mobile-app-upsell-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0,disabled:function(t){return!t.isMobile||!e.Views["mobile-app-upsell-view"].shouldShowBanner(this.appContext)}},"signup-rail-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,additionalViewClasses:["collapsed"],disabled:function(e){return e.isMobile||!this.signUpRailTest}},"flickr-chat-center-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,disabled:function(e){return!this.appContext.flipper.isFlipped("flickr-chat")||!this.appContext.getViewer().signedIn}},"partner-account-banner-view":{requiredToShowOnServer:!1,requiredToShowOnClient:!1}},loadState:function(){var t,n=this,i=this.appContext.getViewer();return i.signedIn?t=this.appContext.getModel("person-models",i.nsid).then(function(e){n.set("viewer",e),n.elementStates=n.setElementStates(n.appStateParams),n.hideBanner?n.set("showPartnerAccountBanner",!1):n.set("showPartnerAccountBanner",n.isExpiringPartnerAccount())}):(this.elementStates=this.setElementStates(this.appStateParams),t=e.Promise.resolve()),t},buildContainer:function(){var t,n={},i=this.appContext.getViewer().signedIn;return this.get("viewer")&&(n=e.merge(this.get("viewer").toJSON(),{urls:e.URLHelper.generatePersonUrls(this.get("viewer"))})),t={theme:this.themeClass,"show-browser-upgrade-banner":this.get("showBrowserUpgradeBanner"),showPartnerAccountBanner:this.get("showPartnerAccountBanner"),showNotificationsMenu:!1,viewer:n,isSignedIn:i,elements:this.elementStates},this.appContext.flipper.isFlipped("notifications-menu")&&i&&(t["notifications-menu-view"]=this.subviews["notifications-menu-view"].get("container"),t.showNotificationsMenu=!0),this.setContainerWithTemplate("global-nav",t),this},activate:function(){var n,i,r=this,s=(this.appContext.getViewer().prefs.keyboardShortcutsEnabled,this.get("container"));return i=["photo-page-ad-scrappy-view","sohp-view","products-landing-view"],n=this.appContext.flapp.get("activeView").name,s.one(".mobile-nav-toggle")&&this.registerEventHandler(s.one(".mobile-nav-toggle").on("click",function(t){e.rapidTracker.beacon(r.name,"mobile-nav-toggle",{action:s.one(".global-nav").hasClass("menu-open")?"close":"open"}),s.one(".global-nav").toggleClass("menu-open")}.bind(this))),s.one(".mobile-search-button")?(this.registerEventHandler(s.one(".mobile-search-button").on("click",function(t){e.rapidTracker.beacon(r.name,"mobile-nav-search");var n=this.get("container"),i=n.one(".global-nav");i.addClass("search-open"),i.hasClass("menu-open")&&i.removeClass("menu-open"),r.fire("parentViewEvent","focus-search-field"),n.one(".flickr-logo-container").addClass("hidden")}.bind(this))),this.registerEventHandler(e.on("add-context-to-search-field",function(e){this.get("container").one(".global-nav").addClass("search-open"),r.fire("parentViewEvent","focus-search-field")},this))):this.registerEventHandler(e.globalEvents.subscribe("window:resize",function(t){var n=e.config.win.innerWidth<=700,i=n?this.appContext.viewportData.getWidth():0,a=n?46:0;n||(s.one(".global-nav").removeClass("search-open"),s.one(".flickr-logo-container").removeClass("hidden")),r.fire("parentViewEvent","resize-search-field",i-a)}.bind(this))),s.one(".mobile-search-close-button")&&this.registerEventHandler(s.one(".mobile-search-close-button").on("click",function(e){s.one(".global-nav").removeClass("search-open"),s.one(".flickr-logo-container").removeClass("hidden"),r.fire("parentViewEvent","clear-search-field")}.bind(this))),this.appContext.getViewer().signedIn||(this.signedOutTest&&s.one(".gn-upload .gn-title")&&this.registerEventHandler(s.one(".gn-upload .gn-title").on("click",this.signUpAndUpload.bind(this))),i.indexOf(n)<0&&!this.isMobile&&this.signUpInterstitialTest&&this.startInterstitialTimer()),e.AnchorRepositioner.addOffset(t,s),this.registerEventHandler(s.delegate("keydown",this.toggleSubmenu.bind(this),"a[aria-haspopup=true]")),this.registerEventHandler(s.delegate("keydown",this.enterSubmenu.bind(this),"a[aria-haspopup=true]")),this.registerEventHandler(s.on("keydown",this.goToSubmenuHeading.bind(this),"ul.gn-submenu")),this.registerEventHandler(s.delegate("keydown",this.keyboardNavigation.bind(this),"ul.nav-menu")),this.registerEventHandler(s.delegate("mouseup",this.toggleAriaExpanded.bind(this),"a[aria-haspopup=true]")),this.showFeedbackModal(),this},showFeedbackModal:function(){if(this.appContext.flipper.isFlipped("enable-feedback-modal")&&"en-US"===this.appContext.lang&&!localStorage.getItem("feedbackModalSeen")){var t=this.templates("feedback-modal-view")({}),n=new e.Views.FluidModal({appContext:this.appContext,noScroll:!0,hideModalOverlay:!1,maxHeight:!1,showFooter:!1,classList:"modal-restyle",width:560,htmlMessage:t});n.show(),n.on("activated",function(){n.get("container").one(".cancel-button").on("click",function(e){n.close()}),n.get("container").one(".accept-button").on("click",function(e){window.open("https://www.surveymonkey.com/r/DRRTGRG","_blank"),n.close()})}),n.on("close",function(){localStorage.setItem("feedbackModalSeen",!0)})}},clearKeyboardFocus:function(e){this.get("container").all(".has-keyboard-focus").removeClass("has-keyboard-focus"),this.get("container").all(".nav-menu a[aria-expanded=true]").setAttribute("aria-expanded","false")},toggleAriaExpanded:function(e){e.target.setAttribute("aria-expanded","false"===e.target.getAttribute("aria-expanded")?"true":"false")},enterSubmenu:function(e){if(40===e.keyCode){e.preventDefault();var t=e.target.next("ul");t&&t.hasClass("has-keyboard-focus")&&t.one(":first-child").one(":first-child").focus()}},toggleSubmenu:function(e){var t=e.keyCode;if(13===t||32===t){e.preventDefault();var n=e.target.next("ul");n&&(n.hasClass("has-keyboard-focus")?this.clearKeyboardFocus():(n.addClass("has-keyboard-focus"),e.target.setAttribute("aria-expanded","true")))}},goToSubmenuHeading:function(e,t){var n;(t||27===e.keyCode)&&(t||this.clearKeyboardFocus(),e.target.hasClass("gn-submenu")?n=e.target.previous("a"):e.target.ancestor("ul.gn-submenu")&&(n=e.target.ancestor("ul.gn-submenu").previous("a")),n&&n.focus())},keyboardNavigation:function(e){var t=e.keyCode,n=9===t&&e.shiftKey,i=9===t&&!e.shiftKey;e.target.hasClass("gn-title")?(n=(37===t||n)&&e.target.ancestor("li").previous("li"),i=(39===t||i)&&!!e.target.ancestor("li").next("li"),n?(this.clearKeyboardFocus(),this.focusOnPreviousItem(e)):!i||e.target.next("ul")&&e.target.next("ul").hasClass("has-keyboard-focus")||(this.clearKeyboardFocus(),this.focusOnNextItem(e))):38===t||n?this.focusOnPreviousItem(e):(40===t||i)&&this.focusOnNextItem(e)},focusOnPreviousItem:function(e){e.preventDefault();var t=e.target.ancestor("li").previous("li:not(.divider)");t?t.one(":first-child").focus():e.target.ancestor("ul.gn-submenu")&&this.goToSubmenuHeading(e,!0)},focusOnNextItem:function(e){e.preventDefault();var t=e.target.ancestor("li").next("li:not(.divider)");t&&t.one(":first-child").focus()},startInterstitialTimer:function(){var t,n=this,i=!1;(t=e.StorageHelper.getItem("signUpInterstitialSeen"))?(t=e.moment(t,"x"),e.moment().subtract(2,"days")>t&&(i=!0)):i=!0,i&&(this.signUpInterstitialTimer=setTimeout(function(){if(!e.OverlayManager.hasOverlay()&&e.config.win.innerWidth>700){new e.Views.SignUpInterstitial({appContext:n.appContext}).show(),e.StorageHelper.setItem("signUpInterstitialSeen",e.moment().format("x"))}},4e3))},signUpAndUpload:function(t){var n,i=e.url("/upload/"),r=this.intlMessage({intlName:"global-nav.UPLOAD_MODAL_SIGNUP_TITLE"}),s=this.intlMessage({intlName:"global-nav.UPLOAD_MODAL_SIGNUP_MESSAGE"});t.halt(),e.rapidTracker.beacon(this.name,"uploadButtonClick"),(n=new e.Views.SignUpModal({appContext:this.appContext,signUpHeaderClass:"signup-upload",signUpTitle:r,signUpMessage:s,beaconPrefix:"upload"})).on("signUpClick",function(t){e.SigninHelper._redirectToSignUp("upload",{postLoginUrl:i})}),n.on("signInClick",function(t){e.SigninHelper._redirectToSignin("upload",{postLoginUrl:i})}),n.show()},executeSearch:function(e){var t,n=this.get("container").one("#gn-search-field").getDOMNode();t=this.searchUrl.createNewSearch(n.value).getURL(),e.halt(),this.appContext.flapp.navigate(t)},setElementStates:function(e){var t=this.appContext.getViewer(),n={you_link:!1,you_menu:!1,contacts_menu:!1,groups_menu:!1,explore_menu:!1,weekly_flickr:!1,create_link:!0,upload_icon:!1,account_menu:!1,search_bar:!1,signup_link:!1,signin_link:!1,right_side_signup:!1,vr_link:!0};return e.isSOHP&&!t.signedIn?(n.search_bar=!0,n.signin_link=!0,n.signup_link=!0,n.create_link=!1):t.signedIn?(n.you_menu=!0,n.explore_menu=!0,n.upload_icon=!0,n.search_bar=!0,n.account_menu=!0):(n.signup_link=!0,n.explore_menu=!0,n.upload_icon=!0,n.search_bar=!0,n.signin_link=!0),this.get("viewer")&&this.get("viewer").getValue("isPro")&&(n.stats=!0),"en-us"===this.appContext.lang.toLowerCase()&&(n.weekly_flickr=!0),n.set_not_album=!this.appContext.flipper.isFlipped("rename-set-to-album"),this.signedOutTest&&(n.right_side_signup=!0),n},isExpiringPartnerAccount:function(){var e=this.get("viewer").getValue("expiringPartner");return this.appContext.flipper.isFlipped("enable-partner-account-banner")&&e&&-1===["embedr-route","site-key-route","browser-upgrade-interstitial-route","products-marketplace-eol-route","products-account-payouts-route","error-route"].indexOf(this.appContext.routeConfig.module)},onSubviewEvent:function(e,t){t&&"mobile-app-upsell-view"===e&&"removeUpsell"===t[0]&&this.subviews["mobile-app-upsell-view"].destroy({remove:!0})},destructor:function(){clearTimeout(this.signUpInterstitialTimer),e.AnchorRepositioner.removeOffset(t)}})},"@VERSION@",{requires:["flickr-view","hermes-template-global-nav","hermes-template-feedback-modal-view","search-url","search-autosuggest-field-view","querystring-parse-simple","querystring-stringify-simple","notifications-menu-view","url-helper","person-menu-view","group-menu-view","browser-support","fluid-modal-view","signup-modal-view","signup-interstitial-view","signin-helper","storage-helper","mobile-app-upsell-view","partner-account-banner-view"],langBundles:["global-nav","common","search"]});YUI.add("hermes-lang-global-nav",function(o,e){o.Intl.add("hermes/global-nav","en-US",{FLICKR_LOGO_ALT:["Flickr logo. If you click it, you'll go home"],YOUR_PHOTOSTREAM:["Your Photostream"],FOLLOWING:["Following"],PHOTOS_OF:["Photos of"],PHOTOS_FROM:["Photos from"],LIST:["List"],COMMUNITIES:["Communities"],GROUPS_LIST:["Groups List"],SEARCH_GROUPS:["Search Groups"],RECENT_DISCUSSIONS:["Recent Discussions"],CREATE_A_GROUP:["Create a Group"],RECENT_PHOTOS:["Recent Photos"],THE_COMMONS:["The Commons"],GETTY_COLLECTION:["Getty Collection"],GALLERIES:["Galleries"],FLICKR_GALLERIES:["Flickr Galleries"],WORLD_MAP:["World Map"],APP_GARDEN:["App Garden"],THE_WEEKLY_FLICKR:["The Weekly Flickr"],FLICKR_BLOG:["Flickr Blog"],UPLOAD:["Upload"],SIGN_IN:["Sign In"],SEARCH:["Search"],CAMERA_FINDER:["Camera Finder"],RECENT_ACTIVITY:["Recent Activity"],STATS:["Stats"],ORGANIZE:["Organize"],CREATIONS:["Creations"],FIND_FRIENDS:["Find Friends"],GROUPS:["Groups"],PEOPLE:["People"],CAMERAROLL:["Camera Roll"],CREATE:["Create"],CREATE_NEW:["New Creation"],CREATE_MY_WALLART:["My Wall Art"],CREATE_MY_PHOTOS_BOOKS:["My Photo Books"],CREATE_ORDER_HISTORY:["My Order History"],UPLOAD_MODAL_SIGNUP_TITLE:["Upload your photos securely and privately!"],UPLOAD_MODAL_SIGNUP_MESSAGE:["Join Flickr to unlock 1,000GB of free photo storage."],HOME:["Home"],LOG_IN:["Log In"]})},"@VERSION@",{requires:["intl"]});